<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Protected Page</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #4CAF50;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #76B852;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }

            @media screen and (-webkit-min-device-pixel-ratio: 0) {
                .staticrypt-form input[type="password"],
                input[type="text"] {
                    font-size: 16px;
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Protected Page</p>
                        <p></p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="DECRYPT" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"016fc1b2cbc69a26fd345d7cdb9690e7fe0e06d7730aa8e34d2d6fde0394d188f45cc1a9da579d792b1d3a33c0db1455ac6b64ab92711f5baf31fe568593369c5fe8ea9aeae89f3385a7dd69bcf6b70afd900ef84025cd77f37572923ef9f5f8c66bc978a63473284abff1a678e49f9e8ac68c8fa1a4db5ecc3ca2d5982c714c3c0915282ec312062b7aaf20dba1b6ccd587eba00b699c82870940d86c1f8c9e9f8268311ad6e8f476b8529cfe06ab9eb669c327133b1eedae735ca8965408bfae241b441e5f4f591bdd152e285be78abcf38f2b79332928af2b66d38ee9f71e1eed91cd634cbb04f92ed307451961d4fe20b91a2a0b93246a8c8942f11f7a196e12f996d71518e38734f0b60288e86907384b2820882f348edae747c1be4a47218afd7cb7ea7dc30e9323d70c9ebbb69db07b44c969805f867df0ab1bb7a7b75537ce3b1ef0d01b9a97f0a876f89afd70bd72e603893272639c3da2689b5f703d6d52d26be91ac0f4ce7d7cbf4f65ea057c98aacf1a4e7c7604f335d71ab256ed844f85ff6c48bed6730540ccb05f52acebe734876544f8e8bb1b27ce45f3bf1709947df9bee05d8d081d1c2a37c3a4b7bd294aef64fe16679a6f91bcea7723f63eaa7e1121f14bd7bb4f28ca4af37b0111f9c749f66476e4c1e49e94750a5d9cdcf351d3c619be039b0c54391ab7fb29bdbdbf8867d143b95fdb1955a63a65300abba3ea01230e8986050f1e0fd450d6974c7b5eabf2a64c86bd2f20dc94a5df80df579f2bec8b7cc10528328a106b9129437b2bfe8d95789c484d4fed2e8f1875120a4e46ded808f552920c52036d4a0a0134684fb33601824a39bd0a223e3bd0fb493e1e0e9d6ee8c02298c36c98ea8abbef5e60a7a001d60f44952d7c9e79d66d55f16c87136d08f8930bf7a22b47d2aa2068b851d6079b93ad150b84612589bab90aae75ee72cc8f01b143e0b26391a8771731517c5b200988e15480086c8a736e94d946888b20c9f5363bba5fe1731ce43bdab53ce9283d59248afb87b89b7e423cb74eb4d8d3b0c3767a15bc7ca28fc9f14076f359b1cfb7d0053f56031535da48fe79753927ae2dc88e0fe4f0a4f3fc4d79fe193862db87f60a80096083422a534f1a886efe2cf4c14d750b095c2818698f57e886e53d715928b431124dc609bead117f3ecc44be6b14af12f14e9ee4ee7c998dde5ea914529802ba3c284d103dec6b2749b78731a26834f55df7ea0f0b951cfbee3df69ba3567dcffecc37298bde80c793d71d6f987b39b176819dc20566fddb6993ce58810ac3834f069c3a76016459c37d40c7495456cf125460c4729440e6851ad87637f1bceeebf0c18adb1e401c67b567be2d6b6e39c8cd1e728a21a05803e19524d11ee3cfe5578b1d8fefb30b9e9c47d51f0b86ac3c087d7eee2ca0b2bf6b2b3d8610e690d9f8d66cf2a414f0f0bf23d3f8e30cff31133dd29677e8238887a221bbb6cba1311dc1b13d4bf79f7fed9416b86d9d6aa1d46d4d3cd88bb15a810cc3d3c07f918540b68e2050075e9758d2e6300411a9fcf77721f06e42ce8c6ac87f7549e4753dd6fc576dcf186623d405c642209fa1a951721993fd0ae7d2efd1ba7fdc0d1a6643292f166dd214bbc1963d69b753297564e12a782c368d3a86754a46f179360b7ca46ceb8f00c90940324d9fa2f2386aef83a8d8cb783e232ac2c40e170be6b20a145bf4c7b0bea932661f03da7fb157f2472e707e9a0d5c76fe771fbf2e7fa719d30a782400ff2f7e70c558cde44bd0cba93418b5f1bfc2efe881f6d23aba1497fdfebf60ec22345b6e61612f89e7f541c11aa2121512da15d121b03c55707275a8ef17e9178899c1507d92764c7d4e1aa441730d6b8a22d491b27296be80fad7d81bb2fc481e96ef733241ae09fcbe8adff64bf1ec8f40dd0407745c5d923dd495f9441804d8a35e8fea4dce999e503c63649b51d96731336c02e2fecce90df9015ba05ef593764fb8e06cb9de4797c6695f375bca2b1bc3b631cdf2433e67719ea73d5a9c283dcc4ce03fc0e5f877800e2fae8869fd2f2d4f7c35b175027a17dd59604f2cf69adf75474d28253df0b49a5c4b6d5b53645c406ca35729a3c2e241bb660978f62e3a972a0c6d2dee94583b7cfedb07c2ba0e269213462a98a4dda29368700c11ee68a2e61dbd341a671d8affe56a15233f9e50fc55817de46a0ecc89d73c27dc48f5f31b8c1fcec11e67d09a9137f2a3dd735f34bfec0cf3bcd8bf8f1086dc97676f1a985c04312ec2ee56ab4c020265c4adc6bc9f701e36b0d84868fe85123d5bc6499e30641f231669dcebcf56dd1435defd6ac72340ffd51920be5bc8252ea892a5ab470195352fc67a91ed9e84b24e260c12b97c04f6c42df2c5b650192c9d75f8820cd0a09a573f79d07ce36fa4a39b92090155371547af88e53a1a83866e88c25c7528581d9b1952c240b88e07190acbf298aa8b65da5d2834b76ca6da3565a04a37db09cdb3d056de41db204c44e1c86dc2516d27131ab1b6dd235a5ed1c4b8dcb85e1942bc5bf0d3a092ea44092bd1c89ee5adcbe0295817e65a9f535dc7579379014b2094f2fc1f44f914e0cb2c09c7369d2e0e2efba64b5c4dd394f223068a86d2bbcac139d1e05f900199ad241f415df9e59eb8583a61606f15d51eaa81ade1706934c2e0b338efe2721c1367f23416aadbeebf004ff91abdbe4e32cb72ec7228447706946af6252fb29e38c59f4374d52e291696630aca6bcd4e61e1011d4a761d3ed6c27c2ffd438b8c426c74a989530973fa807c1643c6dd28adb782e96ee708c112a036b1639ee25cb2c4f72b64be3d4924e64b22348ea7f00ac75dc4573c85a83f4a02cd5b7a04c9afd833ec284db73c89bc904b7f1374fbd6e69e3bbc055a7fecde3ee2018ba89eab26d40d038382471e2e2d0ab837564d58b9c4594940f1ac99135b21849eaef7dde795fe186c5675eedf25492d23b208935de8e31d6c31f1305fd7251b60197f63b1965d4c01bbbfc370a428a13c1f606fec7bf84e3df84de6722f7a40dd8190e72b08b3ac3c4a6f83784b7a606393b3ae189493397ee8186365d922e0a4e89484a9dc49fa8395359644d1de9f10056110dddae96c985e1b4c483bbdcec05c0d0ea04227eb2b90c59866a079487fff01959e86c348fb34f81b4591f2dc17c401868f140d60706b5ae4e2998175eed1ad911b100ba05f236bc21e6382e8688a1eb0750ca210155045b922ea71cdcad0e120e8d5424265cd84e316f59e02cd228edbfea71ed4da5e6e53d4ce9dd72480b48d3669e5c19e050ada5760c8778688fc62df0d182dc723303897a36f1beeadc265c6a2180ac9b612004ac24210c35e303b36af949e9ff3d53d15fe4a857384646aa20a9c46c6018968476b1eaf8f228530b48c30f7b24de2fa256d308618661ef2f61ecc9c89700f655fe995adc4cfdea8779ba8e215c0bc6542592a131d554c72883283c6d1ffd4b985d5d20ff01142106ab3a7ee06f13bf28d5dfb74ad39ab34467cc5e15e89522b4b8a4d3378f79f20b5622fbd08abf8c65d33a4960e43148a2262b25b731c10ffccd4e53d385a372f2b968f5bcc11c852910d6a50be40fa3f1951e093ccd2b1c58460791260d6567f0b38d246d8a3b754210edd21be5b59a46ed1e032876673de3bb01e134e70742c43010805d0a0f8cf9821dc40b7080a8a0ef02c6c121ef31ca88483d3c503c037a634977084b6be68cfe8f4debafc2a1762632161e3a49c8252e5e8205721fa8fc1d8d041a8b8557918cbbf150b476f9e33c3614ca4226334f4f7c65bdd703e9f5f58ebf4e745873bc4d9d03152d3b59657d80ee8c3abd3275233b7fb1ebc73a59b671e6aa742efb16e4128ec033fba1201dba82f034f4db531ec08125c3855862b5670892426feb10d46e37666ffdee593f56021ec598063f5279cb046f82f8e4a68eab9d145f53105183474c6e5cd6b48063a26e4b721612d5f88a575d5b515f5b006dacc2caadf8e877f30067f5ea4b1e5ae55b6ef46da94b505add9ae5337fd0551e3f428d828531adc8dfb89cd542d51cf3c4e1b1c273c70b6f873e8ab0284f58637f4435222daebf89243960d60017b56d1c3d588c13046aebfb5686f93291ee7430a2d6a3dffbc4121c683fbf0a4aff36bd42e7bac281a966bc3361aa3488c9c3c3a5b6015b90423d5a8ab61f0cc1211f36f55990a7a7fafceddcf3e934fd2329042e51e926109be4ddcd4520e0073af206016bc57a57b290127635e27b1ab937bf346c94c71aab31bbdc4fd56b65fa643a9cc8de1dedf948576cbf3195e68ad14bfc432d33911920e71370705e4d3747bae2aeeccfb458407b6a1913649a09cb4b69367ad69ad20e4138aa0839cdc3454ece223de5123ee6d05b232f49a979db68bc7b70258648c93f0dbcdf0fe90b9b1e950a995c478835d243715bf44c16758720f1921993d096fc5098ec9d0320910f9ca9ca97552d56e2397239c1419fb5a1f5fcf9b1702904ee0d247cd4076d33a8dc3e91e775b26d855fbfd8363f3111cb0a4caf9f3ec54c02e70caf5679c3402c7fca200630e9740f5dd46da550155b0fd78e2b62fa71979222cc778a3fbe79b438d0e2eb3c84b6bc41ea800ee7d5e532d90a2e4f98aa810de785741fb315651b7cf38c45e69c45b17ff77625fbe3977885d46f91801c3d5dfb0cfa48e5fbc3982f25c6ccd4b6a57d92ca91b3bb79b81a6d4558263980a92b6a6d3e90c6971a52556062369a6954931c801e58d46ce4454ec51344a072392e5f39321d9b3b5aedf7c840573bb82a94d834f15db932797bb75be3cd3b2b87ebe629f006bc9ac85795a2a5a01156afef0e00f5b5c36f3d086c4b3e1ed20d6b3ce105be9d0ca59e608e02826cabd5a24b81cd6e4fe1d88a6bf42764fc7699cb38a00f20870cb842d8abf21868db9c8d61465fb0c386fb909c1444da5c3a04a723b82e3016c2993716ca9db7e705ccad881137106903229aebaa2067127e8295fb3d541f855e391dad3378f8616a4476514a55c1075c3190b734c0e119fe32909e2ee0560907b0233e0ae75446fb17c7cd75e8269ffd4505d96d9883eb36f0da27ac3607d7cd8771c0bb78c234176789f6faf3db62eb7a09adf059729991d7cf349bd1c8f2c3feff6819fb8f5a800dc994fe20bc999ea0e5376bb8184314bf901a18dcc3238d91a24cde4802a3e1dd6bdebf0007105a73714ede160863a9d9b8329b7646136efd7cdddb8244da65f9802ced3579ff9fc4d5e95f40c86d58a6eaacb9d4f949df078bf333085f77065530db77e5ca35523ee5945b4e4746e7e4e51053f3fc55aba48e6e265d0b5aa19c1b1c3285d54efee4d7f857c4ab4aef5d7480ed0bb90fa623e063ce964c1becefaaac62a594273592567bcfacbf170696eb8e9be0c4579e9f5821f04f3d31779a333deff87d59a0052ac63d8459341facfbf625f790eb997f1022c8b20a2a77f55a81eb9aa9fc2565a513503bf0d562cf7b9edcc822c6bae77c5093a57b6d8fe122483cb2ae7a4a065bbde9b671f5162e3687c8919384aa8dfad4ac2fce90473cc6f9b51be253a1858da47039d2b9dd578d8c8eac29a7761e7beec0511dac81039567d12f4031323064eacd9e22486fb626e793000273929ceaa32b1b24c0f0a91bd01bced4cf81d78e78361bce86a92bd554dcd25ab48ef47ac5c0308d91a5fcfad44482a4b722b4848eae16916be71e6b32e3a378aae1e3502d637f36b4895f0b4d9b23ad13a095a5648c6429bff8d21037ac3d004a5924613b49b1dbc25121971c090030cfaa7a33ac30dfe05135afa6f410e0cb9f58d329f656355ecc9fb0aa63fef7405dd1f6b171f9695a15d16db269e72628bb2f31a6e5f509c6625f30b80c1be32e167a51bbb379802a75ef5a5121bac8617ce5fd55078eff0c48696cf86c823d27cf546e98c229b7d3caadb0b9503bb070adfee324f034a086992d8f447cc3974e32b3cc611a1a7ecea6a21018b2d121eb956545a242c8793be8b1d9ce17febc4b44127a932a03fcc01240815bd8cc742bf1c7ecbcde2c6c062f0378a44f5c80e6fc362f1ddd7e8b4d72a39dd00e1d5ea60fc9f4be97047278e266d3824b51379fe54235628b80e7e0d66836470159a40df8f597be6c558bfe4e86685c13ffbc869a094c8bea5e8ea710354a1f9d8c92ef4e382cd963a6c892f3783e4af10ef419d3e2e34241e1d21c145821593037aa5c9d30e326372ee9a8abef79892c28b1678cced7289ac5862f4a28e6f7f2b53d88d5423aecd33747858540ec52113bd16e717662a3276a340e6ea32a3e7fe54f3a68a22dc40b4c6425569f32dc998f65a16d271edece601322e677f519cbeffaafcfd2f05f2064fca385ea6d005a3c5253059b10b2d343c72680f569d5f1c0df6f2ed2ed6bd796544ecc5e4344f5cb431a3863d71539d2e3dc7180c5a65464814692eaa5062aed4f9680f31f2a383d12cf3fac5653fd88ec3aee26152fb2d3b3f7b52dbf2b232eaba348df46f82c6f7a0eaee77f73c8aa9e67f428a78df4288b877d3fca4ae748749fbdbefa31c14fdea7b0dd7e6362aa0f51bc84c2ff9be6ca0cbc8af50081d3ee966651067b81e28fa8c70e66fdde0d06b2df9b3bff3de3c07f198256fdfd99abcd8b26f7f25f1414cb11e0cb564a2315050387e428e3c80cd26fe087d1d09b6f87449d7bb0381a1fc4db53ce86d7e3c80587bffaf4062e00bc28cf7f5ed2b4d2cf2eae31526558e439891c81390132c229151592de5ea1d2f83de0d27eaaa6fe40300947cf790b279512d968e05efbd87739dd8a52e133a24885d12fe4868405b1d918ea1d674465ed3e5b335b9d49a06ff79beb1b75606e77552c0e826c2fcbeb25d73567d0fce81263ca1f5ac36d5b835605be8d2ab455f1f2300f3851ed9214ff5c3d1b7268eb107fb04e7a5dde56537ab3e34f7d4ba9e507aaff67e1ef707a9d2ae1727757599876b00a5baf65dd720581ea653c5b0763916289d93c58e3ebc6282f133ad67ccebd4a832c3a8952ce56217a6c4f923d8602b7b4f95a06febf625378813ef47df6cbff350c8d911a05802766c4ff6c36f62090d26b266f42f2b097308825f29ecda2744bb55c6f09bd348c3ff56cb7d60a3e92e0109df84e0cbd7f9172f08e5dca8bd96a8a89fdabe84ce6164141e3eaa75548ee9774ed4550e062bf68f2e1f513ca4d683d6661d9dd02a428520581928f904abfa0bb343e5e5044c35ea1c0562f88d1f02fda311e804185b05d545a49456aea32e16431728bcd7866707d0861b87bc05837001d6568e7bfb2397318e50b531f74123292bb6ce6b3f52603d720bdedc36d197ad969d7f979890c76786e7a8c3e033d3fc722248eb7a4f4a24ce99fe5b898acaaa0ec624c5cab422110b74f50d4a45ec113bed566abc756625025199423208311ba89f318e325cfd5ef0cf2c71a457120856c37383572bf971e5a6420b5d680205431541ab4fd314974fa19a5fa7b09663504c83664f700c0aecf07925eb0393ece0b4dda91c3fb72fb2a98fc30d987761e1d2686e276c1a425c5a1793d52e26322e06cede8d123604820faa249a4ccd2ce2d3ad9e738ad1dd8486463761b8b8948729b2272aaf0969701151e6be89fc6bf0b3301c54176564c32b9d503179798ffd42ed597d007cd040bf979b4e618eee59b1c97a123c140ceed9d32a9af7324a196e3ca4c2c16dceada364e202240a9ac774a41afd31952020ddea51456b31acf7a3fd029f7b4351ed8fffb2fa259c1670587479a4000b59bf590e93cae45349c3b03d1704b65d5f319161d288a1da5b0f031bb742aad1ca48a3cc4e9e490d022d1444b893daf97e1f622062528c6595fa0e933cdabea5b4c6de30a8b4897517ad5c9a6842169a9dd6cd9b3f1aa5e0e06cad71dbb3d3c20978d9f875b185f54a1240f9fdf00368e1faeefd0b2d4a6db73127746d3203c02dde27879e0fd8c8ce6892a9887969caf6cc878f2b3fd853b60429935177ddbbd289b23e44a81fc9fd6c23398c5426b1843ee85f31b903c65dc5f922a3fa61ef0b087ab15ad5fc517a00df32eea6f9f94dbc8ad86af5c697edb85d4d7b0a9338bf15e5ec3fcfa3f0d8ce6029c664baa78b1d3b8b40b609f53ac0ea2e063eb34ca1db3a6cf1e857f4f462543e410b0ae70bb99b77b8f496d3fc45d8526d00069af97c83d095166169b5df2518e45ccbe05ce33e96f809bdbb27b511373b0a58e2886ec95b1509b8690b42a7c53ec32862d3541ccb0b0eada40a59bab56a46c8548a50f948fed2d94fb4b0cd709146bec0d92409d7989b66f241da6f41f34f650d56ffe4ba804afdec56e9e87e0487a2249780687c911da515a01cad32e43e06fc620d07e6e765df925a9f9919f19a5d0787924d5a06189243122ea4b24cdd3f24485bfe7130b25e54d873970c52aaf3fd0124e454534bc31f5f615f669deb3e6b6808fa7490ef00001d896104ffb0c8adf7ad27897d61b1c77442aa340aeb230e9563fce91fefe27b0aa33591da060c343af34bebbaa5ae20912a03786efc37d0bedc2e79bc3a41546d2a587842ca922682254c033ff897cd8e9e71a26c9e70d2f8e28cb6972074bcacb159147616466f2758bbc0fd1c0da2061cf81c4053d8b6041bc7a3b3a6b28cded5ff46490f7627066366e4b9f661a3a7354dbb19be99f6d23aac3af2d29709f0f8984adfd939b0505cd22723eee9674f542c975a4fac5acaf406a0cc03a6067845f8a1a3dc5abb1632d5c97333ee6a2cee50bc7b9d1622fa96121cfca6dc130677d6e5b3c29cab8d4f0fc4c2a8c66124ea2002cdaf14311c587a012fd1cdd9d84fe97576c2989eeb51807bc7c13a1fcee1b33b47d984b478814f9dc72e579fb2ccad6826d8e5151a08964acac75132c8a6f951ff8e2aa67a404c07677f9929f7e14074f223466ba0dcdade18cf11ed987fd55a32b1740c24ac1dcc6ea9f0e45d8d52741bf28b2874614854bd7f1fcb306b1bcb72ab006f3fdf3d8d54888839db6d17597d30b8def719b861b6c3f6b58dc8955413ddb41e10b3b597d2018eb66ce8ed5ced74552862b00b117ec221ede719346b00c9d5fded119445aa34818226b429bf751d19d6d7015953427c1bcc82ffe5e6f0dcb365fdd9ee32035658f9061b0d9853014d9e7b9aedb1009232e65c0f94e02f9318f1a27a18cfcb83476a41cfd86d693dc8a883f175e496598bd7052fb39179c5d1d51144b668e4128a8e4d631941c314d501edc8fa18e5935192d08c9e8492caca6e89c66218953d0ac020706c433b95b764d498aa4f941b511b542ff174f5560bb78639fde1fac63e72a3a59a1846923923afdcd0a50dfdb99d7f223706bee6840cace01a98c5ba2d052a614ff05554400fb0a3f15663c239d1577f34ea225a2d516c73ecc43aba34672ca448928192517ccc67fb6d839edf214157a063e8d0bf3cfa8164956f37b0e2ccc15174e7def493336106423c105e5e1811f43ed0dcd367819db4ac8cbb7fe9282df5ae73618490726cfa33b0ed6a6bf9b8e33a842ab0c2e91f8031817fe41a3d11c1aab7a4a55bc5b1acf9d0c1c2622bba9abcc488589e8d8f453e59a0da8e12687e3ec1e73b71f043e6b18d1f854f54abd6fce4dc3426961ff471c7ae8da95124bca8615a2ce93c98dcd2a72a6494da2f60cc98373344d842e333d75f2b752265155b4610b03966586ee671e6d1c8f533cc7a4b97bfde887227443e877836c596a168b7be4eba8a8d3cb77ed041534f73dedfb0eb2f09b3b51a734fec430031cff489625706c1648410578773e16360cf1b3952d70acc9c8348b8f4f452508ae1e21cf0c79d5ac73333d4c23014497a696d21074e5ce204669c1ec8ecae297fe64bcd16320f87f2b728fc5bf19d96d04cd140391fbfac4d948787477686f41667009fa3d7ece78a34048880dbdcd34dca47a1356617c358d4942dc58940887a0b10203d7b34bcb8968d29ddb0dc0e69adf11e439b5f295d51df9e4403e64c14b67f5a21e99f425b091b34109be7f71993ca92766080b4e1b9e4449fc97a2446bb000acd2c64880787a2e4d608ee3f8ec460107a1c71b2e7854f3f27225736ac6c516c21a58638a549678efbbc25c68b1496fe276ab8050eefd766e4df5a8e8d5fe1488fca3406e7b5a4e489f8c7ea61d6f84d2e55faca3b2fae7828444ad268eb2493d6b52dbccb89f9f03a68a5a1db6288786f42f1a6c1a6ca1f5112882fa61e94e2e6cb43e2df7c0c5e29302dfecbe636c23e8eca614f6fcd5b8c11f215ef3e7fcbbfe34ed25068c41d2c8c5d7cdec61850b30d3df0236d081147abc46f8770cbf414ba95b163068585fe36972a14c569b8e7d623c21c17c1b4f939c6783d65c5697ea94777fb928e2a9647551839a755f8f80aa03bb39596382b8fc87374195e1f99c9e923281f584eedec0f666444b69acd0a8ec288e3f6d0c616f7bec25116a8e505357148eeab7d69937d9e59e37a89afaecc61ea11586be7ea0e13d4c26bec39d90ba85f38fb83f84da6007034fe593317f8a27e827de95ad12a40505e4d4b1742cdb0a4d73a127b108ed5e13f312b546163818abd4d7f1bba81db7989ce49b62ca2c3f24728340225bcbcb37f2b83218d0bd3c61f0f86541b683e564c613d9b9cc8815784c5cceb41c21e13e875e763e60732abde2de7dec19413de8e3e6b628f60f532e3cd5b2f12b4ed91ef153eae361cc49fbd22ae834289db3b7eaf3491fcedf8c6935de1853e767587ba5b014061d441d689855f89e0c114b99fade11648e4ac81f2ab9676fac195542697c3aaa02c27357f7ed6d8272d4ec3ade172807c532fbe4e7d5f833040dc7a2a6682c1637ff6947ae4793257bfd14c9575e394828f0e70348b1b89894510417f0cfb23b41023cbbfa0b5a6f6162b60132447b262b32f5b1b2d277c3dba51e74abed4517e7ce3dff13184653475ba09696eb63179c3e8a629045290eac77896140abca7c5e7781a59b15c061660373c7c34ba0aed8d32b278b11f29eee0e70276e77447297657b86113ab0db0c9f4f8b0344d077a4ea9ef3cd1a7ebd27dac655fd3c291bc8deed90161a9967717b2ffccceec6c55dab3b380ca4e304a39613c97cc8be56285f0999ad7c772fea476c889be6583bbc876ba60d2d018762bfe1ab8c1e316ed3ac6d2179a6686798786dbfdce09c02c269a978c3a7d1679169f611795ff19780b32fc251007a4b337941b9e69e8265772cc2a6dc9fef21443c568ac9d7328813a7349b1218baad0a9bd24b9c914c55e1a90a476798696b8842a0f295fb200c426b46453acf1e25aed42108f5cf32a7d73fa5ed8ee85d2f759eb82b9c1dd985d5a3a40437b127332797d2060beb3918504dda87714e069494e3d5e37f83093c6b8d54677a91e28665adb689d7bd7891811e6952ecf67dd26b6e6b50c3c1292cc7cc718c2cc1bb82a6a627e990edc85e46cfb788c3b84d25937f749ae854aee2baf24bc3c02d788803c991d84af52fac228aae180ed7c6ca1fe44eefc0623a35013629c33301ca69e0279dfacc07a183601af2e9dde0ca7d7460090790e0cbd7916b8c70d515d1ca269241067fb6db00137975d732f8a43c75f6d8f7f742dca7fdb05525bf361ce60913b9e4c29b87d0bcb30c87990fa7005451ec9c92c336930b0dddac2a0e4d8cfd93fadf30d51449561f6f7e0c5f00da2f4f0475f586d104aa4c73334334166086f3fee9a5440624cc20f8467a6b7ee3bb57541da20de49178d1a2ab9b35670f70513c90bd9c9034371b62c8cb8dc4a5d811e0c222e2be6b3dcd4441274b747f15b89f51b740080e5b41dbaf7d216502e8700fcb703097bb187377038b2780cbd9b59097ed5f52ee82997dde59f1546777991bbb4cba500c32de2caca47de1b16f64d3b05d34fcda1c331a02001fa431b25d064bdeeb2b7d562b742895196452e250221ed0def127baaed2b00565d40aa421845194f1cf3e557db89c4e0218a1b654d6b2b2f07c57947b38bdcf3822a991df2177275b6a7de5bc4b0e0eecd4e87a17a0ed8ad90af4d4be3285cb2de9222539fe819ab170f02d640c4287078d02b445f8410d4be67a51ff594f0421bbbc0fb3b8689cf0a96635d130f01adac712ddf1ce803da889586b169eabccecb6c1443620302daea11aff389ac3f2cb9a960d8ab8b27d273b5ccb26c17ab0f7d779149fc153da869cd1b45bc726150bdb374497679e228ccc3a3fa23e077fd8a3bf438327ffaee26ebbbe010252832eda7306238704a5475a1b5e96f1e265b9c8c621140cc02976071e0c58d6d724ce862550f3d976a4581d462d27c44ab10d0e18c0e274a8c8b26b8babea188f383d80e581e22e922758dd7eb4e5c3c2c9b55ab0bdcdb7c87597b74b2593371a25c447e11edcb045fda9fdaa6a5cf3adea952cb469198c9091e53046dc6fdbe9f5e77da6d65826e29d335549393c26fd91aecf7485874f3fd684ed790ab1a5ac008f833ae59be11de9019da482f3431bd99c14ec3f050cb4c5b12b24cf11ce541ad7c415659b2f1ebcd7bb0d657a5a0b9c72b89cd9db6bd153b875475e856186e91084f7690affebaf61775d6fd9bb5ef437d1e798ef1a99e3d18cfe06509995c11439bf9eb9ee0bc046215f181f79514982100c3039203c58a5ecd43801a422e7b8b41013603d989d5b84d0be839ac0c44565372fd468bee331d1c39fd7c0d8b14efc24db6b39334ba79f51b3960a0514777969586e9cc6515c159c182edb4d4f65c253c964819b214c9e1c52153244300a090d08e4460ff3e220f406516ad33e09f4a0d677d82ff6873570f9b2636a943e8e71bb1dfb19919195c30daa434577e6fd24b46d9afab5ebe8a64bfc623079622ae4862971d74b6b92f39873430e5edab2a8f0c0f42704044fe9b33a4809f3f6dc5577a050f2b0d18739bc6ddf5b9c0384d57b94ca3cea5075cb1b4ed7f29cf1573fbd47f8e8bfb7e5849f35b9bb28300d49dfb11fba8aa9fdc1d29e2ec6d57cd0bf552c2459e08b96c31c90493f329e2ea5bf43522c451829f511149938bc16cca68ae87223a0ba44028bd2ed1848f87fc6a37e142999645f18cf06c152e604c3bd413fdc2f77b6c39c5ed8f8330f6d8d23cb41c74633dc97c059f139b89b89f3d83016f79ae044f5154853f03719b405b371345de0da15ccd90d38aba534f933f18e4edd47fbcaef0dcf34c79f7c8bf2655928ec612b857026ddda74203d81e86861cc59675e7f9bd2f38bc8a5005ae59566a6907e78f2fff05c743b849381cb44ef50a02f008e173fef171e18d13e946013678d05e5a560c3f5c8792dce5df88bd9452c89bde07176e797d3da0412a7c17d0808afe578789a0d4510d5df6f7fc8b85a91cf0dd5bcf7578a0e8c0ed4884a86fd9d234dd567bc64ccc30c8ad09e91def071d34f97089f575b0f6a467de98d22e4899e4b5002c763632e7f917afcbeb21d7a39e45fae28dc9406a0a949b47bd7d197e3923b4915a54e28ce95aa25f2edde9083c2dd8c832d1e6de99180058e7b7d26b2fad59dec12adbf9dca9f818906697379dd859f960deed204851563d36f1fc9ec6ec531bbd2cac7240cf20c5659e177058734dd0f481eeea950ccd478fb3279ef3d04b6855aa0d8fcfa1c9e618d08ccedddc3e28e036f8661be91bc616da26d4e30f0746e00a695caca5098d71648e8465e366c8507971044bdeb59b9569965fb5c9cabebc7ff08d3444c7eb350cfc24f219c36a5de14adb518992b2d37fc0ad935e57731d74bfea9b4cd82496e3653b1c4460412e3183dd8338fea999aa78cb804988cf50b91b3cd38972356fb96d5f0f255d2f710e7f7e02278dfaca6e32346d639a50d273c7b05281c6743144fee0a513bcc31629d917f1590e3ca1ff039d976f9d23a934eb6a3d3e00bf04d3300234f9718f6175169611a45846c1456bca5180aaf2eadd7b6619741d120c27f8ce6db2d34e1ae00f129ff924bc5823dd24af3b40f2982ad1d17441b0a2b48554b02059600d9716fb59fa4a0e31d70c0576fd8a5b931d74813e46f9b1601c8d4c7c0d97fc9e6c455cf00620b26f57f1a71b3c2c676a1d162577aeb8cba639a3c4160dfdc1b8ac8ae57e5c40f206880d7de794259cc50962337d51084475586de92e70706dd2a1d3106d71c7648717d288c5ee4e134e186e5dce6f301fc9c266de71b644ff7f19a4b4e56472c12d51d4ed7673017f954fefaba9bf44b5eb9ab53c84405bc136b4c93c3e1d8b2b1cb263964ef8984cf22d0309cc7e68b6401c709da14cdade87bbc3ae21cb0700338ea4c6754d965085fb689a5274b2fb70b99cdc66e3db35668396e90fa745c895c0aa5fed7666d6327a1ca24bf5178b34f7ebb0df58f80a3ff1074773d360974d55fff7cd0af767def0d88b5cfe75cef220c7da63356e6781094fb5fafb1a771c81620f99cff1b716f099ca578bde16cb38df2415bfb32b0a786cc25ed4c953cb263088018314cf0d00489f438078ceec57ee5438d9e6d978703619c3be676e1a910ea045e4763496a6359c14d45ada2f7185782027f58d625062d8487fa004cdf753be70bb8380f5b54b4987be613c1f05fa3299bc4e56ef705c753a3b85787a255e47b210b0bdec9c1a382b8c17e80fb9cbe58a2fbfbad4c2a90ea395b5adfeb651bcdeda14e2bf3fbb648b0617b88069fd6f1990f2061e35c61a1b44c8d8abec0be072d8475cc89149b3d47ca1236778e53de70ea924b434660914aaf257d698524bb1db6dab8622510beb429f2713cde4f3206b9efd648818c3f1f8d0b4771194e05ed3afde4aa7e37bef90a4c575f89fc8d03acf5a4f3ca74dae298caa1c762162cd6b7f158ae4479cbdffb6a41a2dcd6b27fd6706ee529ebfbd7b5147fd029916a0e250d847c6638245332ca8a29bd8cefe1e43862a32cc191b3ea28e5c3a4c8a385eb74986a835f7399c9bc85052b4772a5140678d417501c0eae09cbe25409cf115931acfb4fff507f561f54ba8ffdf294e64e55166e4295dcbcd2d4e229562171913b1ba123b1025e60756c9e3563f6581e045996b51c8b01649f336924931b96bb98394a6361bfe49af4e22c135ed125728667f77fea814740c17b2066a13992ab0a83536ac8e3b3e371bbbec02ec8a1078808a57e02bbe4878b4b320fd18bf77f626e885a7528666dbde6509086edbc7f0b1a36460baa6a099207ffcc44266bbe1856d08b7eb73645433fc5c07b25f07efdb96b11126a23bac99aa92865f552110ac3bc0af5bdb40def08ffd458b0bceacc712411a3f973f796ee3106b23ad7558088b5a92ec51376ad9d384a068226a647ab571f2d393e80fd22408bea433ec813b24f085acfdb7653c07d2db1b6de3be1b3a177f0c647774fc0d53fb6f4fef19582375c3b3a370b17dc3e7c2fbee36aaceb9f9c584433c087128557624e12d1a013afe9578d4b6e00f4fc90e8c233c4d6dc97f1d033efffa60cbc5f6b011826fdfdb3a44a552879f361e847c73bd2c6616e2d0da4e7514c17f33281e0a18543d5a7a44f37aef5819d18dcbe7807d50a59eef0a5fbe0ebd053144c8c720d9f01a50e00fc486b408649e50987182c127bb4221f0e3aa7558249218fccae9747ab4d2b338482a0b7ce4def49b6f9c2ea9105c1719740cb18aee9e88b1abd4d899e0524e7870a56928e394e3556b3e348d96603b43d2b697ad4612d9b9536d4d99d30b9f09dc11c07d63af141ba7b2417b503a55579c6f90e57be1ff9f79bed287d867fa474b44fc83586874de4c9a38556c5a4117cf1001d4940417f1ca65b8b55cdbfe2f4a3a0413e8bdfba26400fc50eec9e4ee1b9b75cc6ed7e5335c4033db226321ce795c66cc00b8ab3e02fd21aa01cb603d1b2578b4999dae03d0807681bfa4db92c43e685e141d54656e401706a5ef6377f3dae3c32546d31d2d423ef8e2f5d010e2657c9fae2f6595d24a0abe3827244cb0137eaa00da4f61c01d7191d5fa2fe60eba3b6b1b1dda3c53f435ea2e42e70daa2d6e457a12ab40c1d5e233e94a7737959d4cd04bf3d9a0e859151af2a8ab4cede2c1722335fcfdb259626fa533b77df637bc0732e26f3ce9d5e3bdd9fda92afc75b8b35903c31ec04bdcdbc9df8366808f043014deacd35682f0b18c6fb83a29527381442c41db3e8787485a97460bcf585395c1d1a0c791d2ac21f93842f94c60bfdd57b2f344fb5386de0d3202775426325da7d37dedc273fc88b2b940dec6012f70a16a3114a1a649743e20293c6e4aae527ba6d40e8d9a4f9dc5244a1b22bb020c6e7c3b115efa51112d2e897921e06d35a81f7b5195143b8263d44998f43fcfcd3a6c18a34932db50daea9537b7a09059b71a6622124c967ef79e78ac4bf7a0725034cc6d43ec547d3d94218ff8706014121cfde158c7917158a518be9bd784a43f11998a9855eaec46bdf13a1bef44aa70d97903298085376c068b5725bfff12443d2fcef96ee09d532745fdd3ea656e131ed732153c8a38288aafb2365dccab6c2aa0836a5789e9c9771608b95f2de4634a79ac0ef33d99cd5f22b5565dc5064e9d6d1a86f51be59d095a7077af57b0dd26edfeea22f921e75903cd8cca15e5600b7ed0f08077895169807ae6445d96127f694514d6c0fe2addeb77102adc0d0f29d12a76ff377198f3a1586c5413aa21756af172920201719b907175b109feb0a9b658c827b59e37b018f2974fadc0ca69ebada69823236d8c8c848b0d70ccc0b2afd1cf19b769c8a6a5124f5f94b96879d98c0de9883a486bc2c79784c731e60fb222b8b3c03e3cd575f3746e6b58f032f9bf5b562d9b51","isRememberEnabled":true,"rememberDurationInDays":30,"staticryptSaltUniqueVariableName":"666125d2285f1dab0f009ee7052c866f"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
