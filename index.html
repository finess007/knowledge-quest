<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Protected Page</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #4CAF50;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #76B852;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }

            @media screen and (-webkit-min-device-pixel-ratio: 0) {
                .staticrypt-form input[type="password"],
                input[type="text"] {
                    font-size: 16px;
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Protected Page</p>
                        <p></p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="DECRYPT" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"11de33665394c86aeb9371b253c878d411f630c5ef2438a1ddd44d82fb8d20532c286a8e4352cc5ada5b2d21e84f0c9de6b8e5ed04748b76c1a9026613bae4577731ee794a271e06752426667c377a23805a3b7f748638f16f31ea626cd1b006f76fea6c458a1db958a2fd600ee3b13fce9c99f3ad7c231dd733cf7618cd286501839d1f77fc64b899b90e967f3ca66e5456403ecb19c5a362099fa011d8cb851d6e1db1bb0691b946a73d8ec56c9fdbea02f3de1ae17cfbba48be1070a1f526fa0fe7c98b6ba7777613a1f3eaffed4cea8cbc4bebc2e86731610de68f6258941319f11b50b67f515983f489f85cf9824eeb9bbd3ffce0f5ceb5946001d76bc5438c51540f18633db0f6c4a6db5aad83566db3f854166f9b70b8ab33dac95324e9808bb3de77e6e37d7514b8842f0bbd05f70bd4aa334530daf992aa70599181fea1e6ccdd5a80fc359a9593f0bcf96afd43682f6e150cf8acf42445811875585e1696715ee84f9fcf6f42fbe0b54a6dfd50f6bd1c2ff68d8693c74ed4ae4c763b422ed3cc12a57ecf8fe3168b95e83e85a7e7bdb6b9674622ecc91b379744968cfb7956c4d56a6e2248cc1ab4c516d88ad101f628c4a8492d0947a3e7e7470df48ce78ee1274ec101d5750e21b3d444e6c3144a36af85dd88993a47ed326f545b43994060b2d0e0e46f3fadf7931e276bfe68e6e0dc1b990a8631822a3f0e85447d474e87507dccdf0a5a1db5f041bccf8282942b3dfbff3647f8573df8a4c457174060577058d4716e9c98dfcbf80ea5318e13a003e3098aeb0e11b26041387afd09f27ecc183f5ed37f5144a231595f0bb6b621dc9466027a2d14562fc2eaf5b72065e485afc9b1d60ebee923a8846d869c47cfcae7a58676213fedbcd5cfc55918137ef55f7cbe68e20892b57c0ddf29d8c2f00155113ae715f5bfe08d6d57c7ba643360afde0e3e2b90c913c202026b246a445d4e1fbc5bbc72d08d6416f4803f3b9a35bec5e9e5a8e502d2275e8207a17b6bc523274ac68632b51cc067b31b7037ad598bc840cb1fecf5a841adca869899e7e43d3fd9570cb13c402008c51fc3f8e0cefe0ecb1aa47c315e190f013e98b42eb6a30d5b35bc147a17dc3009d789d2bb250dfc8bf0c15fa73993acef9ae4892ac8c70a615db7fef2161acfecb3608df3252d35eaf09d1ba47b8b2be73ce968272a9d2d7488b3a474c1cfe53791a1a93831995b94025be9a8cf636af229d72ae751e88c3ab231a74e91a36de634d0c1d5ef018406d3751f2702d3c21a82e46fd373f9f0a1993450173ff8ddbd2624822a8d9e099d783238fa475019e2f6cda5d261695f34dd3cd98600a67dcbcab1117565c81e1a5b0aa50d2be791e670f76649932a66dde0bbecaf7a9df96a2846b51b638ef842d613a4ab871d554d2fd2a34c2799227abf9e580c9f6383b23458c7fd0b80ddba8da13cc962011721d80e02e459bbd3072dcd8de84333031e7be71f9c90d315fa21da4da94c97b09940c875ebf05764ae7cc7314b9cb98aa15c78e7a0721ca005504bac64c11ab04f9a6b3f8a2335f684d15403153b1a95797818af7685f0bb4e4c6449a04e6d05a6e520920961fa28564de77443580a1137e7bcdf93077151ffb2ccadca0a3542f2eba88342d7abe9b9ceecb6a60fb5bb04e8b68c980210b40c60c93e5f7a0d7bf73e2b0bd6ba695d0c497f150a0f929eaf98112196a797a609548a6a00bcd76fbda7718d92230cf1e9eab1243ee0eb0d8990cfd15bb33a46f40609cca4a9e13201df37302ab9c8be9aa23cd9fb74837cb84de1cd1d5c4f0ca392cb5261cf8037b40db06ec78054a1fbd94a008c522e5d2dd0dd93220e3fc9e2ecb46718ed4d89db604f0c52de625f596cc238bf7ef6a43780b2923418980f9601214f15094b4d9ca4bbb086764b439a78c02eff677829f8f2a85fa47243985182aed9d9b0aa13ce764cf102234216a1e634ef6d0cd7e13da029c419306965579ac5b2804ba1c81f06880cd09e5a8c987b115720cae30536106fc6a58eb99ccfab705433098cc86baf83a6af8a403e6921d19a5f3178272fd44ba4f20fd40d90f24208f27ff68cfc4054fec75d98600edcf3acea6cfdcc52e70787ca89dd54c3b3ad0e6193b8b0a79781facc02019a8062689792674d9b7244b7d365d0232cb878fbf9622f6b862cabb07ee3e0e18a572ee96648600bc9583c833ccc9f6977f4e7d97da210e69378a8fc80a6d9a41848b4121a799f0842465e9b3ae4b0528128ba56f77ceb836ff7e13ab8c4ae7dbd2704909ddc29741b4bc39004c6938557302ea40d2e4998beb4118de9f63811ec5b247c10cbe960a8ad0b1b3f324026b03a32a3dd6aaddd8d18736bde0843ab41cd4b57b96268993c11b0d8255fdb764a840ab3d8f1e54309ab7d69c39d2c473b126d1287035bc3f303f98b222f36946300954d49fd573a0f0b77ea37f52eb12b471c36b59e93f482a704e1200e08b20a14112afd6dc8828c5e7c2dfe09c51cce8a8ab12bce79fb267f4cf0dfbc5ce64b50573cb051c947b2d1d9f28165e78bb826e6335819570aa3a069cc9c2f69c33d5235089245edbdedfb124e5fd12fcbc27a52b50d7dc865d9adbb90ec16057e1a3a99afc8538497b54379d21b8e760e4afcc90d6bdf020add1341fda997b6c40d3895417ee46d0b4636b4aa343b3d937ba9793885c32a0cb12557ccc8408ba36c1f1b487b6c0fa1b4dd453f1e943a57006897317a5999f69312a59b0600682cd0ecaa2035276ca5539f94d72a040145d942a2e91454fa557c61ee57bd48d178b430bd27b1279a42f05bc2a2fcf3e31b537c0c2eb58fdc091bb37b7b18b69eaaea69a16a06c526c7229d4c4de3e76c567654e05b9377308c5a48729c967ef202fbd602a46c716114c63abf55e1422da18e90fa6d5d7a08ce54384b72f73299b86df5a1bde295d2d87c8f2444ab29b0462acff2946ff810595d2c0ec749d86026f5db0d011aefb2749a987fabc0c5e74df033ae114bf64a88832559d3e9cd8bc2d265fea0d352b8cb8f37993c532df0f127ccbdca0630c78fd9e31479225d962b09c748cfc1f8e207acdd31f825511800c5287a0b2e0687f4d8422cdc7cfd33ca1a59517fc6a6a4e5004413490cc7dedc7aaba9f3ab303d955f3acde61e377a251bf2428ea8b32b345381fd6193952b2e014b26be80b73d7a7f7e13927aa0fc146d584eafd5d5d36a1624f2ab48fc37f814caa072afbe8c9aee176f2d261555c74477a03c7862e395a302e9f85b412fc601eb7681f07504ab550b9b80e951bf9696af6b985da442b6b44901a3218fde47f286bbd4e132cd6188c75e2f787131149b1f8306aac4ddcdb4bf4f012fadd8b98ef1adc6c9f3dbcddab00e055f31e5e8b81718810cea121093147975113d906ad94b96e5cd6209b7f7c208fcc828666e9d6460ab82215d41320fb05e4a1f13b641cb64be115bff05e894d0b08c02cbd1a2602f262c9a13661bda9f4c6a9931bcf6adfa28e53e3ed7b24811b9137bdd20628216d23d6eb529f35df4e984da9b63af2e5a1383090234fb84d68fa29f2fc038bbca91ffc5212fd6bb6b134e1b4f23aa49f92e8fd59d35adf5ca0e1bfea4cf1e41837d06c58abdeb4aa911deafc28be24c0df1d421cbe23eb51a02efa6b0544e36438e36919cd1ec49b8c08825ba3d0e6fba2a2bad7ee2d44d4be990ddfe082564685c3dee91e87af6509b78c1233974a87d53cb82b78b8e85f4321daab3971d7e12a712befa284c96917034ebd6e17a8309bf05c20bd7034eddb2bf2b5dcc1a289ec6b608983b8709fe1cc41f652d7ab6a969c8084c3ea816071924462dbf564123d6c1bece85aded677c6631704865e13e14436255f2eaac7e6ffbca1a7c6b7f40dce6011cf8da2bd22f9a2963dbcdb37fcce59b1853b8c36c50cbb4386c605d530ccf50eae964b7874fe8c8397ced4129365394084afc5891c6daedffd08899ac6debad7844b34b3ce1503fa213569e2082273f98009a8c348e5734737b2e21ace8a12afdb6ef00a453b981e1fc7bb6d9a368169ec366082c49f887ef8226e1cc19c0b889d25e267ae24a823e032056135674a40ee75898b4e97089262a898df8fa3f22980fe3aa6943fae4a883a61ce78ae6a176412dd0aca0637669fd30308c71553b700a33dbf06cbe1ad281fb8a707a0aa934c6c29899a45f55129ea1ce5d50d6c8f3759757af90bd6bc7e3bb5653a555413f9cfad881f9a1580ef9a50e60ae526583d868ad64866cdbdaae2f9b0ac02ba7763c0942cba8ca5b9151461a619bcb08d76f4ffa3a58f649f222223ecae2b1e2d5a008069a9277dc7dc4d37164f0c4ad4919c920983c9f219a3350a9181b79bc4857120fa8514b76cf63d170018bf98adac3bdef488a9973821ced1b31a83dde47125d1bcb5eb2cbb4d403dc0a549eefbb0c490e6821f1169ecb22ef47826201147e9e7952467c50b408dda41b593877747d4c405843c19a773ce02a0e62105c2c366cdcb37072f192f9eec182817edb1c6f4f757de2a326bf52a82040cce26c38a687d74cf60f3213bc06cacf0041c700fc740de1771e3e685c73ef8c7f072fa4ddc8e0bb8aeabfff8ec7ca20f222b95d09447a246d4d38146ffb55b47f4cd639174726859d373b0896996e7d867fd9b0351e77f5c3da46c93bccca75d7231fc71e091a346af0ea57249b6f82e5c32860b7d4368b81ce1586154f69142efde06334d8edb0a35245d7014e3edad5eb846936ca535f3b248c497137131a221440c408699353098f51f3bb8a378c7f73509bcf0467fc168337d9851aa6e5db9fc4b19f1b03e157e689c99f39156d0883c30db144267a22fc580ed7d91da82b8e68a393ba2835d3e05a01c521318e80a07b7c0b8a24ff1051d6c31665b333d6b469b26daf0beb1b6bb1b89d1a0211c37537ee7887da5b83eb6030031638564da2f16fb0245f53e089e83450d25ecbd155c59c5b2aae3ea7f1d5b533f297e7515fe02ea696cc96375234a100cba217d74d9240d072a9d973e4dc7eaa0f10f7ab3b20994ca70874049284d062a6237b834258900793a666001a43b6fde020296f827f8b5e27a2360977e55208bb8e372c8687d08194be5a99bab527376fabccdf940703a79a70131459e009fff25e9161020634acac8a31c665b933c10d6b79886f4ea00e3787f968b8e0cd70ae2fe7f993321008dd1b16d9adb6098c04c31ccd65d0b3d862d77abb1b21e31883e944775cdfcca4597c4579cbbf6b739326bb08d6ea19ef4bac973b5584725929d045cb90435958a67225556747cc58f6edddba2eae67c9acc8102e90e591ffc088740ad3d2a5c1aa8c758547177f305e26dc13bf1b88da5bacd69120c1c3ec1d2dff24fa25813c32ec55ecdd7570cf4915f339fbd0d2873f234ca796a2c818b332e4ce354b1070f6bb976575380a15a26f787bad8c526c3bcf0ea3b652ff11c401a2d4e6ae291db714888c66bc36280d976a871711a29fa1639a4abbba355684ecfee6e1e398e58db96d460703f2ebb9084268b5f8cfdb15f0983ae1f3c65a961768d5e57dc59a882f682b6ec318b7ab4bca9aca9ce5d941da42045479b0eb5791a708d76c14d760ce498980e6a0d1b78143607be241d211e9121415eded9422bac01c223426005b8c6a10368997c7fc6df69316cca90272485e2b39c6e0b9af032dcd6d00688572e59a3c1d45385860f64daef3ce46aa9d108c2490d89e34866fab878f3fac1504b6a7b63ebb6c0af3b952213c0eb2d7f8d4cbd3894dfa7b1edb8e71d550ab0ef345748c0fc3fa03a1089671c6882aabaf42c68d75f07f292e5c54c3a63ccebe174b06fd6898f902c2bdb6990d1e7047b8e5f5500ef57ba66eab25dfc6bc30588a097b5944a0afbe97adf62966d510a3750801d813adb9f6d616eb722419914db1df94b6e993af47258149b90fdf4eb7672e4d7ef4408f4176f812b55c29ce061d3338a9514711c8320754a951838583fad263b9a0b94883c9ff8502d2ef838dfff66073e55681a7c18efaf5beec206e10cf7902adc910dbf4bbcabfc949bcaee9f31c0e9604b9edc24c5f80767a652e4f9777eea69e3c2cc9b8405a838a8729043da2a13af49de14e3c1286208f1d2588e0c8acd7131b24031bc5ea08247da165352754a412e18515740a1bcab0dac42ab4bd8af5a26770e17e7cc69792ffd4bc1f81412fa22b074f1dc162f9c05c95ea2b04af7c88e6867d862a76ff5f427ca9cd747cdecb34c0083bfef8dad0d571468ebf179976eedf8db509030ed2bb6956cc1a4aab2298f4cfa0bee27e0465947b032705faebc9356d2fea8d8064de2aa00a8f16be75371c9d75bb2f90188f89e4573e22f97bc9abe9b3f284360331bae7ff56204520ba36b9eb63278c4d815a7e189e7a1ca22cf6b94de32e2bcceb3a165b57a1999307b8ef1f5110e6f9d844e1fbb1131c06ca6cea87a4ac6e2c3c74122ae32bd1daaff0b20cf5c691e7c90531a27ed5c64baf549bb1781014ed09cb5ff946d3524aba600dccd7769433b11329671e8d8bdea19446322ca0eceac83b5ed672b6192ebfd5d5c2eec98497483216855254c08ef8b8ae5ff6991933b8f0c20b6928c6eef169707fe0d029f5f4a4626ac205aa5c2b4170d765c5a428e5c9bb18846ad82fa872d73b9368423e23c3b8f32863b5a07c7bfb34f0d0bead7e539907b7a26a3f0839fe46af02922466e05ec11e52a5257066bba2d2d1c0cd8b67a665fa6721fc85c96d01b78c00657c407ea69fda6fd899b71c79dc4a928517cb6f38e20351ee404d43c51e32d710b4e304c4196f39862f57f0124862609975971eaa3a757732c44f00349deee2d6541b5b4827339b7d3415e4f0c62d8425aeeaa4d85f6df18e8e075d9f0c9108ef9d2dc888898b9f62ad0e342a1d3c6917c6b3a55abfbe2fdef49acaf54251cb0b400c2c42819943fe19c0f07c0184bc41e9f421d01330b0a21caa73c10b62f89eb7118c78587400cc7b3962115b6372c2c1f8257cfb251842e869bbd2a3e497f53e8be0f8f72975fac643f5a54d08116fbeae4a04b40701052f4ffc2f154f95ad91ae9e3d1835e74d4c239ba35ba709ab0d2cdbc06bcd498f21f5f56e7cd74f20b191a2c28c23cf00820d43c07011b520b9a93a8fcd4c48be11a7fcac7641c306a6cb36d4da9464fa3de53f7cd0f7214aaa44f5a196c231e863047f5060df4845e54f1eb29df818968b620c0312bfcdfd730ace550af5b2f41c95bf42f133ad40a8c07415926e3fa1bb81ffdf65492f7a513154ec7b856e6f2c255d0c76d982ca221a1262aa1ecb2d59cd7f0614b7243e8447b8005ced07bc0b46290473acd34728ecd7a563251fa38a6b90a4e6818017df9b0fc556474c41876a5185106f4b0dd4abba36f925620d8537fa775b94d160437f00f689de8b797dde2e115117fe16cee1690942414a979fc0fd061293990bcf47012ca1733ac7ae785fae054260bab2e6d76fdd79ae9413948615c7316d99fcb299019f7fa8a1004ff6ef3d03e28c8e969c7b0be14de792b97d8793510b52e79ce05d9989c527b17855de41764e583e8a827ca762a5f7d49b57795428cd36d1e9372a76ddab0c06f671dc023a5f82f56bd339f0e21e4a5e4ceabd3c0976bae9b931c594293402432b5933522775e2023a5524edfb8456a75f690f4e7beee1b189f28c26c11ab2835665d9637e38172b854a74bcde3f1399d924450da9c2e364ddaf7706beabb905cc22bf76debb4fcf81e0b0aa588e70404786b733dff6a67b2db04db163aaa5a5fd8458268f2a1b1af401e318067fd31475ae7d03f90a30fbfadfa1ef3cc7aa22cdc7d5be22eeceabffb0ff37a95150e2f3a13a111b35cc0407a0e909fcfd504879a7aed6abceccbc43a81ac7e926375e2f8a5d0db877ea993da67b6393fab422c9c747cc3b31151f9c06b65db15b6a396855fa1cee86c21d9ac4169608ce836385ea81d520a1e9c41a324939f15b4a51b2b8ae06b0f51f96cae36cf56b396fc6e5cb777e5d84fc29605a0fbab6d9c7844329bf946a13f27686d240b207f5becad6fb7a4c8b40136f6bf960746c47596415040957dddb3836ebca70f43cc75058723bbe81661a4d7c2db8e7cce6282d5344a2a4fac8034649db5489ddc7cd57baa7eb6fc57d69b4fd5f1da59c43f7a90f474135540bda25c364f6f717d6d0387bf6be37787882296c4d4286f47e2954e4f7580ceaf08a03583e1c31ff93c0aa9c0462f959d1c3a25fc9fe437f0608bfebc6273e6477d5498304db47ca43f31d0681e73a27bb1cb0a2715a9fd4568f0fecd31aea34922cf9fa087f551baae52cc36cfdeaf0ff8d1b1793b886dc670f74f7dae9d3bf0934434a27d7ca663a94866ddfee190c5183828da35d4dcbd58bb3c0302ffbe32a8f11306517eb15ed46f3fbad01ab45d9a077219ce784b2e8738acd7dc18ef98661f26504a0a241efef69654b0f72186529bc46eb7690d1c827c7485cb9e3984864a186d569620467dd36b2b7b307948dd76f44fba39245a6eabfa38d291be2af39885125a820929252c051aa94b6c81adf0f28d10211235157f7766627c30dc440f5be32a1149d2587ead0b6893fa4403264636953837298f9ae172b63dbc598636f0939a67067ed668abec1b934c6a6bd3bcae786c8684d4ced7e0a0dccf6a419e040b60b434899b2da7e22f769a174abbf4ecb572bf626eff3a27231923bae399351b0e6ca97c2866c09551e8ade4913b963a202c2ea8fecb468d4da6fcc2192b604cd66711b7fb38cfa8a8db625b6d1b18aa7e5b6037afbcd142a2f721b746d63e12c3b4c21e9fd09e9dc54131acdad8e022129aa95c9c131271a6c555f690ed70dbce414d539f58e2c23506103a774a77b4bf2be02c04f93a8914751f6f5d6726b1d0ecb5d6f7267ecd727433108860ad197af4a958544f9b157e99968aa5c1e75a1dbe68f9679a7c9ece6df88968974a9db48f0f17b76ccdbf831bfd958037251378a9630f778ced25aebc84a3cf798a80971ed0931deead9d3cff17c6d05da23f48b82243dc8ee8ab05fe9afd4e1b8d19c67fd05bae8b83b5c7b13c74f9f882532d06c58ade253e89399b90cab406004d5288d79e5fc20db564c29395ebf7026d81970c02329bc00cbb7799d5335862a00da5b9e62de13705d1d930b198287e22a2b2c462bde0602c6cfcbfc37be74d9e0715e3cb7edeae6f698adf06c24536a6ffbf18464ba0a734b4d4f5c49fe4ebac4730de54b94f61adc25eb9baa67aa5d28acc323fc41b2f8473c0a183610a3cdab0b4f60c60fd6498847435a13359c74652ce83737f310f38e4c1bee6b5ba245da4b6824cc30a6549a1f214b080aea875159d9fb768b665cb5cead3678ab95877cddfc25490e8f469f584525b821c59cc6d1cc8b434a0b30f728b8d199c0127d5097754489010b10bc1fa77f88c3521687709b1855360d655c27b34407bdbb4e90bb9e051f9db3afa8bdee95f69e65df1d59d5420957d3304845312fb5e50856e3915238ce098aa2b644de6ce7729033eb26997af4f6860c3f58d57597052d2b30d47ca01a85d00ad275629ad783443dba41e5ea4baaf05852d0730485213f045bff4357762a98c80d4ffe6a1309592aa8d25f38598e5d229889c6bae75e7c8af74a597af4ed8d18ff4976640a38405e4deba63db97a266cb5d630600b0df5cc830c3a871179db4f7f0033908f02823c8fb456865776f7792687e54e14bf45ff04252996296afa46384ad5c6a16feb272d7989153a339a26d8c8aa463620aa247845788bd75519f372fdc6e3897ca84806851516ee707d002c383fa0faf2ff787e9982a74522a0fe9eb89025a889f13e6e115ff81d0c081d3760c6a88c488324cbfc46258db1e130740e8ddcdde3df7accab58ddc9ef6cfc73d907d698d644f97208e168e36372d3d3288eed4c4fbba0528ec18c97999a4e65c8b493a12ee2d44d044f246e227a0e8ce5ad1ace97f9cf02d11cdd1a6037fe68fd3ebc0f0e35b02498ebd07d5bf1d017a2e2170fc03a6c5413cbd9e6fde82c007fdfe89c515089e7d08feea6b975f1c074880fc475790a03130e8ea2346b893b46534e6b0b898c448307563d8a534ccb502cd1b717e18d40aca4dbc491498478f52dc2d86b1c973008c457c0e6ab70b4ba87d469510bf8cd600fa0e145fe0642630c54a96d749d23c2e80b6bcae27f7bb6c7d616e2826c72bbba7420c2d008a01a1676a5824e781b22eb95ca631ba1ec55ed7f363a032467b5f11d31245641eb4e3cffd6faad13ef6d99f76e294ca6f81531af28875995d037fef5d7cc270b864598a099ce643eaee5ce227c8c6a44ae258372869b8d6dbbe8537f8507f5d7eed923867f4e710a1f9bb0c4f11d460d488fb06a087c8d214879b6ce94e33a2a6662c3884567b6bf843641daf86783f6ff00f4d201aabca91297931bbbdf7d4a46c7987a0cb52b5fd14480b4617018043ace1b54f282be4649fb06012efa983e8d827a4e6db58acaa4320825f8e8027be0aa5e3d04f56616ee8183d33a54f9cb017639bdfabcaa09b9d78705fd94dd811ef54b20fd94b4e2e72d3d0abeb76b15a021abfb59366fe5727c1663a785da4d6f5b1b96e42f51f1acb8e66e7ec5aa48ee5122ca3a06e86fe3472dd086c3f096e6732515d92594340ea81b76d147fc6a2947a133f93dc6a056cede99b018c18b930bfd51a7d26434d07bb5744e9fe28e45f88c30c7a86e78fca7eac106ea8bfb2dd9abbbf28ee461ccc80958d96efa71d39b58f591ea020eaaf9ddc148a94373d9df66cc8650821d0e3125528afc6801a327ad2ab81ed8a11cc0788f0e2f32b12973cc9834720df4f2b301eb846a33ff1d6158f508f49610cc68971e20b4f26931568b92a28d41278d03f972f9b27d76fd006ac4d92512b0b7e6b76ed0bb2afe460edae8f14d6e563bf47db8d9c8a7e317831384d004b043d418475d64bc0ebaf447e411ada90ed07ad4bc6d569008978417550bd18703080fc51d09769812dd0dd369985edef04e1dba50c6509c63f97f97b57acd55510ffe55da38ff3785cf69902b11d876a9f2698215efbab3fe4e7afc27a82d152fba9b8be74d108e340b00d858220fe69bab104b5279d86d2fe0eaeb8fdc6e2adc01290f32a05400e9f1839e829cd23110651020dd3e533ba83d58cb2157d0e62996092c49130643f323331991da55148e60f646c66b92c9e9eae0af911fac6df2bbeba1a80adc11cd8f42ccb07aea11e88507e30128323713a6e2bdc6bdc02510f4daa21af0acd39298ac2544c3d4f33375adfa37a73a113fddadcce397899e14d77cd104f906b8d06c6e0deb987c0a2b3b94946e09c8ade1a891b53d1c7bc2299e662cd498c5a0ac6f5f74c38ad694a713bd59ac94ee48214bba2a03a7e7e6ccf0c93749f68fd7bd4224f241adf25c79244a692dc658d06fc0e82c3fcdbe5ef414c75ca4abdc8024b4602100a95d235973fad2bc2d944212a3e2bcf9b2ff520d488630766ad8a51f570f4e7887fc63a19c46b1c1cf7929787e44fa7938d3fa7854bd566acce0c97e2d5ec7dc6ff1accc24e7cc82ee22775a6a1a36a87edd67862c6221da570512620fce2cabadfe0a455047d7e0ff319f70c6e8e42ca41854cfd04772570160cbeaf64459759015dfebcaf4b8e4789e7a4a1c21596bbeee89e906ae21939190a6915ec4a2e765b231c185d9a51bb067e586f8af164bff21a2ac193a3670c0272bbe8b128faeebe0dd65b391221729fd8591b60279fa3a3d084de1e59084a8a62ee7f2ac0ab01e95b67a113f6cd51e15f6626c5b989dda4c0999f8b1629990b208b0a8962d5eb2564bd5b43bef06a59eeb2cdfda45fa0f8c8029bac77ef36f97e938af915d8b4682ad7ba6f5daa6cd41fe0d80e9271e4c42385aefbf1ccaf54d67f65e07e3ac436f1c622346e221e7890c4a708a6e261300084b74f6f2c5ae5d93fd596a09d514488ce20da6390be68f1a57ee99ec553572c72ff68f1b90b40e160ab8591c3a95e162434ca27c355aee8768b6d52b3a695f75b7c9fc1e8fd2cb5770ae5e8b4fa67c10c92c47701d8f6a2e9d992b35f00e683e2a4460339e5fa25cf50987157eae8930111dae4dc705176c03d2c4d6ad1572aadc99a3713f8bd2e21105092b57246b80ff42eb4b9f48694f36ed93d23a0b99d57942634aa1132aa721ba289cf4a8f97459b4e0cb63e46368a69a114d8972d328c2e63e8bbf309ee01351b8f18d630b1c565abf367e7896e21bee5631a69c3335e121fe27bced5aa7e4003c3464cf2dd456e6be0ff39253147703a59558ed5555dac7b2a727fb765c2718f9973d9d2f0ce44acdfcfa0dceb92ca2dc6c065ac217b9b5209d3ad39b87541f2380b68ec5658d74bef9cfd9a37c150791efa713cfc22b39a82f12557aa2f531bc1a19b4e8ecd241a15aaa6e4384c5733fc2d71293ad908889f7b8fa14ca9bf19a8212bb1af631071668b4037ead62e447f6870349e58ddcc5f1873b6424955c840286c980f1bd5a786b73ca5fb8d47649d553770634a263bc97e267d67277fc57db23c2e379aa7d9e3273a48dfcdbf19bff1832bac0d636c50ca138430e237cb6fd9687848d298152b8f91007a2e3ef8e0b6dad82d89c93cdd3c21f462acd10c41e200eb82f28f01a47d60774806ab016b22bb33a8438b1985c476c511a09800766e632398739d22e25611a5cd1c8e696703fff4cd8be64c2d48e3e32c620b34bc43d743be26e99d3be9538882ca3c07106ceaa970f282262ac37eb8c3973cb064242a91488423b337c9655f4f80a604a6f313acdc57e2a2f51d4ce1f006476f5ccb347bf05b23a78a8fac0fa84e7d9f371f7f9afb06c3bbaeb0eb47f340b5bea094b525e1158d7e093726daef36f6a83ede40b74000c4cb72931070fbbaa86d5efd75321bd02fdbf42d33481c51c3caf84ada3b51e6a8ae4f814e99f3a8980b1e301a136242b655819346725ace3f8eeadd5453110e8246a65701a291da6005f739590a7260a03be00b8c1896f91fe0d635bdcde7b528ce7764e948fe965536972ac69cb2b26b46fcbd0f898a9bd5246a424be6a21099dc3f0789b0b8189f45a11d98487000086cf0936f06fcb82a723793bbcb3ef7f053e1a72518799cf7d43c1f2c1fbf73189eca57cf4599170240f9e83253c62a536269ee397cc95286d06a7e86bed95df567b63044cbc3c9335cbf8da37e7e28cd3b1253e2a26018171086f1d683720c6c56462360e47696073221bc284d8714250010771185ce2aa42d4e90331077f22503d55fceab2c518dc9ef540c509c5be19f66344400c68b7dfd13651d1d1e90ad883cfc5ab0643d45f9907fa828453a70f270f3cc7fc716faa015f74cf226d4010161263c24568d0ebb4cf6307d70065faba99c4374143a3edb12679d8d994833e70b89f587d5858910444c3a844de9c0b8ca12b1c01f3f4db55a58f3203369f85ed2b28966c96d4809c13fa4118043bfa5aebc28020e5f84b005635ce1a16f1206630f30f030451118f5ef7aa742509610bbddf150efb1bf3586314653a90bebfa42593612aa7ad5df1fa7d6c7f94e17da154171191478f6f3af16491efa9bc2bfd7d02ffd1669f6a4d08dca7268c5d6f17f259465ba9d74a975b77bfc48628ee41cc17911019cb8a2047eb178f097da17bd42c4eb0b1aba55c1121238011621a81caf41cedf805ecec25a03d79e57d38e15d70ba4f0fc3e2577bdd30005157e7b1580e2327e838fc9b986ef0ef8d5ab66f3878142554ecf180baab17c0e5ddb8e32965fae551f212cd89c3b03f1a7f9c01121cc5dbe7eaf84f18df2dd79b7a6d4b0f675d58972ee0831a402ebc5c180fc75b55c9fd9ed22f1ac6c88fe690aead5cb7c9dc9aa38b08c4c05f47010ab113f6a2ae8176e2cafbd320c5ab817d91df54d124d0cd6f30370cb13c89816e48da433e22a45aa8e0cfd87f6a6c6c64a2389ab5d0c347e9ef2b0b04abebf9652b4d5202594361eb46325e180f29ec1515f78a6535ccd7ef0cf90f47804d6c8076dccb2f8e608a21b7155fcbd59cde263828b75b12bbe61511dd81773f7d134e3c5b6476894f9e8ec22a07edb002e3f02559ed8440b7c6f59760589c265c24f482581e89be4e805fd7dab034ba5952a842f72d38c8ca8eb7b4152dfd4c5379c9f0777f485eecce80e1b19864b1d5b7732b3c4f525883b58dc667798b94cbf6ead2821bc66a7625ff204380fd364f332fb577a2d956c7ccd18eae445ce1d2701ab423b80a3ec2a36b249e1e9619f1a2c9cf3faa6cabc9bd174bc567927debe5fb11c53846b3b044558136d4b540bc2958977df39fca40a0d4f05e284216e8d0eb426d6ef28361943999ddd0da282285e390eae335accb51e91182a673f3ad241b57397bce28c173eca20465b0d62f8fc27cd9bd261d1436d0dfee0b8b88fbcfcc0bc13165b51ae2d685a86a7fc6b14402ca6cfffbf5a1ebc78625ecc33d78cc69c6fa52c53daa45fc4316ef37d57a84da10f2d518e2a386c2b1c890af7c61003505cf1ddba751816d0cd354ca1aeda738e94d04737ad3d792a95bd4f1759f5f527c198116a42d6affd8a4eec98dd8835c225501fe11be7e381a423c448312a78724b26ba557803162d07a121b91f1071a6f7a518a98b1e57460107b997dc424ca7c894dfcb0bcdb20a923659b5affd3ef92fc07f5ebdc5a31800fc5ecfa5b5eaff32a02168ec08cc974a65c9e8e97a589d47e1e3859727b68cd593e878e6ab66c26027b650c0d5030d5bf8af27037eaf2cd4ddd1e3486f634f13a80d2f2de4955538d151bf7d3ae6eb32c9ff3c93e5eed9d49ebf2484e22106c6e7e08fb299f06dfe5b4de061d9c5b555600d11a94377f3b1739463366831061b7a6081a6659aadc163a309a3b3e8ffaa92dedcb8bb29159f279f0e8db944bb8a6aadc8c4a8c981bf441a159360a664b09bfd74f1574ba7c640af33d2b049e52cab865a1002d92ee137bded965a09a3494e0afc64ef66da81416be30df44e4935e26df960773f790a12622dbf52d0b09c4e7a601abf99793e2d3cf6cbc89224f508be6c81cf46ed95b1bc92ae6b0dc550a28d2bfa25f7da0137a790a0420bb41aec8b930a45d3d31629e1d7b29236637ea0436df4fef2983e03ec9627a3059d84c4bc48e5ea2982b26004ddea978eb961fc3435dfb350856e9d90277e3d40a3d4c0f9e4941d5b57eff1149f38c2f75e74f07927d19891b2465480683240f073065c093f5492256922edd7e6db0aeb06d625a50a49299b290ee7b7e77f2f56160b4b55104e938eeb6dc099b79383891c9b55565b2d2fd32bafed04a19e8920971d643959826244139953b1a2bbe2bc8216acab6b9259ffc41fa7c67a206242f434ca6faf3b65e364c52fc792725303e9771e7c03b7c181272a9718f28d18474bb8bf2afa60896703d3f19b8d135a1fd71ef255997a0cf3c05ab8ffe30ae5c8a872efcddf167db299de172f04e7ca59fa31ff55115183f0b1a77dc0133caeb08dbde678bfe729a2dfe5719155786ee48b60f0f8cf80eff1d9e55b50b3eaf0407514a1914dfa85f117b209be0a2dde706a64315883c937e00d896c0fb348f2e583b01fd884ae34931ae853e2611459734d1d0140ed59460d6a57c2aa060f86e61dde9d98b7e72b76bda5ae8be5b9ff08dc1375490133de79c31abfd806b936965af9def9b760450efe92d1697ff677325ecb8ce02f936f168413caed0a04ab77e8e67a2978b33b97eef6a05f80c470ed5a8fbd27616bade262ff70eab71a40480a7d9d0fab9930e14c95c294a141057bae0114751bd6ecf726a14e2525da92245d97ec8dc618238c3ca12ccb4c20a621bfd53d9eb5d91c58a5a117c158e8b3f9c97fdd83d0b4c10ba8e08cff06627ff753e12716badc41640d7eef1fb3eb1d7ad4c70e21757be88e48404d5d769e884553445cf7f241cff28299709da94a3b26ef73e4d4659cdf4958d9293fe534fc8dfa7a774b7239d4145d9ecf1bca19470e8635a479eb5e3b0481304183ab58710dbfe3ebb052d9550368aa549a3e24aece20c8c1a86a6b2d9f2805b733ca1b3a15f0ca7de7a9bee9eadd53bfd959146f2f8e283a5e00795e888d8e18422ed226d9423c6d35761943516943235a3e766444152839748cc26b420b780746b3d2cdcf152e00f86b51da62e64c8a4be255341724596d6df1a84e87e2e84fe3fcb680408c67a4d835f030b7469f807366f964cecf2bbd62d2474734514a4fbd5181d3e16388ec28223ab040d7678bc9f8cb5e7b4f80aac932739ca21807228706cc398968bfee9a1da2b10de4766d3767d6f2e917cc69af90ab3cc888245308ac32f38969977c035760438ffa7b29845f5a75e4e1af38a5ea20b8efc970d580b81c1a6b72b2a5e3a2d277ff9adc3b5254879e1ca8358ca0e060ce04eab0e29be31b708be44bb77b775dfa1261dbb9f04f4d0565d4d13e4d3198185d48b67bf17a70994ac89aa125a664e59fbd043a813ed6c0d72d49a4504929451b8248a38fe10fd318c7d3dd404afb540db15c7cc6043a9d66a8a717016b28f8fe51aab25b5f358845e00f71dc13763cae7e5061740de7b8ead2ca17008a6801cecead1efdbf607823afe4c717e06346b2251b52ddd860a1b61b98b2341ef49b038a07cfc0a9709fa16e340576fae64b42ac8a849617607c8a606e5a2ca0c286064f5b3dce787c3bad283e5e76188a07fabd5620ddb8ddcc60f75002820d6d7e3d0192c4368c871647b646e5387ea9aae51d2ae7da82f02529ab0085fdd0b64bf9245e7f2335a99f961027d52e608285434677a76f91be6faf8f57c78c4eccd2ba6f8488fe28300d64b999d0ea4a20029d34f3c640a","isRememberEnabled":true,"rememberDurationInDays":30,"staticryptSaltUniqueVariableName":"666125d2285f1dab0f009ee7052c866f"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
