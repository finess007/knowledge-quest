<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Protected Page</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #4CAF50;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #76B852;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }

            @media screen and (-webkit-min-device-pixel-ratio: 0) {
                .staticrypt-form input[type="password"],
                input[type="text"] {
                    font-size: 16px;
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Protected Page</p>
                        <p></p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="DECRYPT" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"6795fa1a97e4485cbc2cb2c7b9c76794df687fd92c74d69ade951c69c0cdedb7615cc2488c077bcf2247cecc33023a2eb54a75a2d26510928fbb517c9c0f29c5a9181584510acbc30b6d4a4b75b06ad617b5b0a24612f0ca45acabd0eac43177e3f0e07f0c2408570f05ff3cbd924284a171f8e3bc82a572208afea41f7f979cc557b5f859021b071350d8733ccf0cd9724e1ad5474aece492d4e5519039fd3c76869c0f14b29c1ad0b882710d4bf71e016f95216235501a6d6a368815ebad2b7994c8056047556597f0015675cf188e14b00592c56ce38ac5eaac14ff6606bad1306249b251570e74356f9c068a2d2acbf4b99baeee6ece66d2882787bb4fd6f142b60206cd5901fca768e0d3dd552d852b6e704fe0dda26676d0861052d0b69b28ea7578e4934ae41b22f774d778f028003cd10a69a5725077dee7ce3410d1884effca04f157b6d2e5240fb2071eb2e2b921214920f75522dee600ea8f0192137abde407f024df33ce302dc236c909109bb929f9b5da2b13f3c2d3e6eefc094b1a9834811ff56fa32da0913ff4c5251a981948bd64a19a483c99bd2a527462c891ee0ad557acba72ee058f6b1e88d119825c5c0ab5351e1c87f455d8622f4ca726484c8befccf12b6a7c339f89cdf042709524ac6749ef2f698e2c72c299fed46ee0161d6825c24ef65cccb16aeabdbd54db94a5ed2527b8dfc26c009149841bb5f08ac9c757ddfb5cd4d77071f7d1df58ae406e2bd13f8ec31f4be54645aee7d3bf51c299faef410462e30e1d60b5ce7e30d0a57a144727e761dc09b7778fb65afb17d5903d61238c69fc835f42f0eb9816422cd0a9855474ea861f9d4aaccd63d262ee66e6b994b1fdcc0e698b8ce5445130b4ba389d880e45ac0cc2d1a3881f0f314b58e3e39756509543e81b4148457bfc2d1f67e1829420a306296a40d42e2c03db8d72f8e743a0b271b348cbeb1d0eb5031b60baaecce85e9d39cb27fb5fb286bc9238e15cc19cdb4f7d2c797f231f839d610168e0715c2f3b7df6218517960a8710c579e53cb3264130f6c405f7c173819998addd4d68a1e67439256b6073831a7b15ae42234f347b5a2cad17514ef8c3a47e4462f50ca75e332a8283874a0c9d85ba688d28db0d8d222dc239381485ca36c3c4d828423bbdbebe6dc4fa87c1b7c2b190b9c57454d9eca9866313faf8bbb0d33b0fd947d4027a36b9a6e43e79ee3e4490f8be3435f334c1c2e023df96c75dbc36ecf89328bd5b2137a8b5ed73abfdf8bb609deb07cd93b03479e7cabf8ec3500b1521829aeff4eb0964e61e495812ab48b9410514bb77ab803d46b3060a5b8f770dbc4d7d181d965662864eb2b4547f22c21852152902f42811bf62a77b55ce342222d5d2217c90b14e4a5708a9ea9c5bcd24dfa35023392b8a4e898fb159707315d5e78ea36222ae76495b6803a4e6f3b312ff26e40a34fcbf946d12c12f938382dcdc341c2e79e4b135e651c38794551ff19a36f6e308b8344a19b88cf42478dc2b9b4d5b8a7766090c590258f204c6245bee158f3dcdee20eeedee53eb74065cd35bcb371e538ff2b40e53478ec08b2fb3d461bf18e3822e87dcc51877bc9863ce84e4d6a9d7d42f421658ed6c6d47b522bdf7d6e337c22d09f0564eb8e29f6b85816b67de69e5d61cb0dba9dfd6d386f00375e34d6ad2f8410c4aacabbf16807767a3ff5453511a1387c84c29debc9d72ff8e95903991740e1175470d71f47c849bd9b61f00c21a63d340f8f63da71f81da00aff5f631e09401655c03d3aea7a942fda437db344e42a2aec6322b64ed3eab042207d85200a46afcea2da5f0082024fe8ec3c3a72d71deb4a68c63095e06dbf5ffb24cd01e05dff8831675984ed7d75bba4f84fcc40352a84c6e843f927ec2e91091eb13270f91402b7f77f3a7a2d947251a5b86f9e200fbc2609fc13d7c5571d637b0820bd25f458db0dbdea9ff49be8fe6ad5044dd826394ed64b1d6db5ee0cf33e0bec80261539b81baafa126d561d9b527fb97facb00bdaae31995350df669f7d16b3e642a753f723ec863cc49b8629e21bf0c00114de75fe7d02f2ffd7bc27ca0b46437033d38a5c07679cc65c176ce93dedfe594807979794fd258b360eb9b0f8d91b7ceb6437c905e5f273045c6d58aa311857fdf8ea15259bcab920105f053ffa9a6b94d20753dd3072568182d50cad2c3551427bf575f000fa95264e057621b7e284d0202b2a4af8a536e04db9549c1a3567eeb201fe33c3340f8e85af48c85b91e273f18368b3b6e7d285f48ec0d4960d28fb31e4f04ffd38a4538c4d29aaf27d3309c952c5dbf662376f029886099a4622886d26b2bfa2ac7bf300e2c5268bfc9dc3b4437abf7a9a8a4680a6b07f1a9c261938ffe5b2dd07656fc70ac270f1d9e4cab0fbf60528bc0c1127da6389aabd8f0e5b825408e5f1a4f6e1ba75bec55c9097035a0f0cad3e99dabd03bc5e7af28657a9e53743c1eb16bf2c1b2ff7373abc71e64ea6e462c0809921a63a3a7e710f0c1f7624638e7103b6b0a8f1834da3706b69586e5265825dbd7b2353a711b7c410fb5432fe105a36aef71f2f5f6f150b8122764b47419b8ba4b71dd3b588e52ed4f98a4aeed93928e1d9b43b08866da552658adc589c18861a70f3cfe2552ee37fd32ca7eb530c1a540198a60436b45013397b80b3fc93e36fa18a087c925afcffce49d2a8885b14c7c9a6b95663ff239de685dfff31a1ea7f41655c06bfeaa067381fe33f6c8a623e204abbf26a8bba611a155e1dd543ce87f02cd2b3c57bdd1d9dde1f633fbe64052c8eff5d664715974cb15601b18a881c46d603279d9d27369f71cf3af0270f2c3134c19abc28e7bbb99cbb2e41e1c04f57272395ca0b72fe9cc87a6fead9b155fd584cf44a14aa93d82bb8617c69dde06c8a59ff0303f4fec4f6e5ed7ea037cff124624157588cd349e93a341d89feb76699ace2dbcdd56939b1faf0609d3a0a194b2b2aec0b3358efb3a467fd953d550995545d283f7ae5ce516aec157cda1019f63b192e3a64c7c7c4d291cb341a6c05f139f3cb1092e11ce536bc7c64218e014515bfb23f831cb3205d85a326f4e6490892e91b37e6081aa12d49e16eeff22178658de68a95e6c3a737977844456843081bfa6e54fb11639a06bd051df97ddd1990bc2d114a3e358721b452aef0c8be3038e3fba1cc3272b05f147cc6da1678a91a41c0ce3c19feebc93768db2823451bb25f63a27940cd4a8fcc0f0bbc0d401db9ee8da6a052e7cb7794a154731dd5a481786b92b7fff30c157fde013ff788f2f8c10f00dfdba75d017734adf36df06a996ae022058728570ae95f79f2d7f42d4b72e52c730d965e74fe92c50ff95bde5637ab904d0d9d7870c4f5c1eca33a3f5dae342cace20593e9d4a6ee4a44f9f10b8e9117b04455c893fa0e3c17a47b1ebf60c04a0aa5db08883a84e10764871d5e4bce324da7b2d7fbd8c2f6cd4e93120856b00971de9b187385e7860ae6061561933ad56346570486d3337d967babee3b128c057362a9bb505aaaaad4e66dc9a04e57aac25e0c4fc162520f2fe121ce4eefff79cf97c8a9b8769108c15cba009f3cebb992b3478f0682a84114456e744b5bf7045bdd1448de60c0c532952d1d0f848f815b9aa3a9331e697a8eb149b24972084eefe52647c15b5332105bb228f5b1bd9ce736e0c3a906ea3bcca752c7ee5dfba0e030b63eda161567fd3777cab7366a5534542829d4c9e9a9c9674d3bf00a2cd5aa214190d3e298466fb42880a4ea5c8eb3dc9a97c7489eec96fac9a331e4ae256032d20848b2004e383e92b7de1816b122e410fd7a2fc35bc08fb4ea6dc678fda790fd86b833c543fcdb48f3d89970d88ae0f1410a0c57502f87193ea7c6709e988080d5d63f58663746a5158cecdaf2cc836c62a9cf6b1a608534c71bdc51a773a4e9e990b49b44472720a4cc55e7332f5bea8825097d47150c8b8815afd133da0f29272b00369ab7bd6578cc6e1d24984c0793aa3d3f8a5211b274c75b87e73a58753cc236defafe2e233c7d6932f3a9081829e1eddf883848f5de1813ab81d4d437a9b4f080fd75cd59450f1e3659535a57a4218d907f616bf84324755fa702d8825e5f84048ed38c96cd18294ffa59d0341adc5498868268a5e4c4ceb0beb35677c624f04f4f652b3fa7d947ea821d8db502808e4d707fb6e8df9733c1e12c5652f81d6b44326f209b234cd53adbd94ec696a7931820d219c47975ad0d39a7552f0214501eaf2e5d21c140895515649fbc4e8c53232183f17004957b5cf2a8aad4a15c337d83583eb1cf05211eacadeec3d86ac4c69eb2dfe00304b9e376047024dd235bb42da1c676fee8ca3e3ca36b4d46c1edcf8cace0bcfedc84afdd343b376be778461dd7a1283827c06d469815b008668f9f1d878d7d8471d7bf26c0929457387b925a3899644ed3648b217ff6a49afe277ab28458b1e15d175c7f2fb37ef8b77633196632124cc9279477b22c0c38fbf63a1708aa86d0a5940800478b5e937cba4ac5f3c78c6270ed01279dd0edd284de397bc3b757e9f57a31100520e0300be23d60d5f3ceec72ef3ebbd082f0251938d2a166a874f9228bc13b63904c113af57ef4f75094d7d8f472c36a3c4fb4156c86fa6849bac4a0d51f4b69e967ff80f66c2090086ff7f3b43ea5559c410ec94d62cb7833453b66269103c4780b7a1d7f0d7a001361e50503cb50105e080a4d37b5bd7f4190e35a3d9ef7483ffc65bab0d530bc0fcc63e5549c0ef7ed4f7893b24e9385c5e5d1130374a74c06340640d2addb4e1a9f3787eb60b898e668cd5bc18f8b4be5cf711f6c5122780111174e1b333f3fdbadb2708f20365154a5a04bf1636907c35369532726caf73e30dfa426f5b6cedbfbbce98ac3d9f74050533ddfd590cba3eb7ac7b7c900423769ab5bae1776a6e0e633825c64cb65e126a6d56d5387e185e559276da7ca058aeb76ee7bd33de8766cdef25377b735a18bc78fc0fae0653f36fba66531de123282ad08be50d5597f89cb1eca497a9263935a753ec4d70108a1a6166e5d6e97cba22db589c9029e7102ca7fcfff1cbd47edc4485bad7e7f2c5653e58ecfee75ada2b7ac8f302265f23b8339cc072734baeb8f1c46c86a940cc4d63a9e34c34d7e74755cec72c238a618437641554da94f2479babe983f403aac91e24d8c33ce787a77c4ab2c95e5dfce9e644fe158eaa7b756d9f2a0a2a59d66cd88a58bed292dafa68ff6a8364b641ad34afcea607a6ffd413991a497aec82891c118eae01ff895e771de679ba86c2446dd1c79bd58a639272a896a2d9716220e4225870b191f2298d74a9c53faff64922f5b94461357727d80c01b592dfc4a38062cc845e09f2dd0fd028b7e38ca8d134049193e479fa9726a14d3fc86d70cde0ceeb681a6b9cc632501fbb406a9061b5bd5bbb8fdd4cff7ff4914931c83da2a96d541351f500cf26ee05a37760469048ee265b491bee6aaf80d1e115f42529cf3fbcee22ae14131b2d505ba16a4edcb232cf2d3898d1bb328cd441fb321682db31b9c22ceabc792aaf589d93d2cc1266e5ff5f11c7cfd42a0bc6024bea526b6b5eff26a381a262b5e643fd110581dd60a774d1532675883684778350f301ecd23dd17fe181e6517c1f7f9efbb83e57152d920079c778f6f5bf3d57842a2511dba44f5f096b0d3a9a803a3a6bad54d073d19134add0d8bb9e88ed06574f1db8462fec6ae22fbc56d839623659d4ff2d22c1cad6fd9a549c6d6d2fa059edc35ffed577e54787a32523d40345c63b2623935528e4c4133ca700d48ec5c4a5825afa6be779e273160de1889d0754b64e79fde6ea610f3cb1daa94fb67981f60a887223d1386f527c936d6b675e60fac2428e6f0f29380ac8f02cde02c90f39ddd5dcc4649195d2fa21745692a97c81fc46d3af2a5ce0b2f673b660b23b632d843957f1ca74c1a531c061784ede5952a54591082adddc4a415b966fcdcffd6db4502d22b19b65bb70070196ad4dd5474ed8774e342c33814f4a1cfd518beea8919bf2b897defcabed1058765c4f649d5e9fa66615790325edaa56c225963ae79d4b30be782da67eb34695505f39488dc63137c165cfcf60528f4d057663a8d2ec20811b866a87c7f0927bfa83b3f30160a1acf96787b8e11a8fd68c227b1d99c7fa1053023b467ecd05c29bda43ddf59a0812031bf938c776cb9c1d3716e221892db4f8305f239331bbaa1591f80864cef480f83c187b72e4d2c3c1f3a664fa9340b982710d13bc68041ef405618ac730b1e1d1a4875c2a3af0d07b6cb3f1e9b7d3f6734fe97b282262212c172dee5ab2bc89d1166fa6634bd81d646b4bca1bc915a49560073d647a9039e4b67e93dfafef2c004b7a4c7570db82c0e7942ed4ab7a35d13ed496c30e8577e9c16976ee2f106731e2db850a967800f91ab288053f5bd9257403bace93d4e9534b382612615ae3f5fd0f2f966b4c29ffe7267978676924bf1f7a3bb04141f0e0be22b352a403f071400161bb8c4ed415a6b10f174cf647579c0a2fa12401203cdcf7f7bd2a1ffc9af26f4d1efd164c8376f7619909fbb7e055ff02b2342ded9f04b5dc3c841ee70eee765bde0454d5b487d5747560fe54017e1a0d86f467814e7fa99f06493c900e747bc0a9ee866797a30896f4295c5fe26c7555c4398f6e73d001d8c935d4ef150c0bc295b9e13f645c8518c55e911fbca41e6b3b555d99d9726e644d3e319e53a53cb32da207b5a307949f5f416260f8dafc60aa830e810e0465eb815c9d76c55ff52f3f67bc73fda6d5dad9ac62dac3f3a0c41695d46fa7a293987797e75502e0df5cdef297abd9f1d88e7b9e8df2b3170276683c5e3c2f31d1b421a337a644016a554721427fc7c11c67c18f762474d06fb550d62649e2665f379aebc80cdc96355c82673656469cbb1ac7284135b0164bba090fd8172b17659254d2cc037fe83b0cb059ef19fe254586548816b8617f116cc5a4f9735fb634937cf769f52d7e5bbb36af5a93b9e80f5d56b6e7d832782b756b6955f54bbf3609be016ae2f5aab660e6f17a7b68c14f002fffcf0d06c56dd845dfb0af1cb42ff6d2bb5121cbf8965f2366ba22193e14ee606c770bc605cfd906ad08cc205802948baf218d6f189d7a113755fb397fced3d9901adbd3ff67304adb3687d30dd936f7e48c4ab44791f413e75319d11a04921e1571e8d99589796468f9674c4a3c4b3f7437c25735dc7530d5caf11f67444b2760164cb5c5b5468b5b2d38fda74e9d75af5167ea752a85560e5a4d09dd64e341f6b8c02d77ad9e4ace0d517d9d4d6ac8849cb80cdc0f8f5030e6fb73107ea4f8d624b9b5ea75bad90bd8e59ed94da146410f43e7377de1363b5ab70eceba16d6cfa95ab4b119761d6fe8296a3c223f44b79f2372446988b35b35196b6e07bc8063a48431325bc85a36b0cfc55681073fd38897fed0888763cecd2f99f90778bdf8eb4ea5447f1ee3d3d4d365dae66ad72b01b5572727a494190ed5bec8849b757cbc662a7bd136ee90658e6d8e69f8d01065569efd8fc29d0fcbde9b28dc0989190cb967a209a586ed0ceccd3015b4643b57dc4861faee4dd648c9b7fbb93007d7237d4c701f52f90f2581f8b323cdbfd772b7f7380bfaebc7938f64a313254fb58ce079662f798253607b477fab71b18c1226c4e25618ccd1e00ae0d449dda3f031f61b671361c24cd44135bd623ed3cc39df16f051c173995b713852b8f2b65fcdb943aa64ac0ade5fff2bde021f66d3a29f04070bffebffdc6637626cfd4880f11001a04e830b40d31bd924c5d5f107bbd022bf2437a1df28945ccc4aa9e1ab897567a2aaa8129ea317e47824fea2fb6d245c137bff81c553ed9379f9e6757337d91995a7762458321eaa12c238e52875b7717e3d6239f0969b3c22d070a64a5a3993372e4739ad4f59423946f103a72f0294890fad749ae8a31422fd6214561ad70d08f246a83e9edf74b745e40882ae5e10dfcf16da44e9345909ae1d563733da5986ed6835fa39a19188ff0c08a7858323462c358d2622197e05876cff447c58ca5f517f5655b26db30764a83f6315b639248561a9f0d44fcc45806bea98c7e3775e599731a8f3fcb9c879c691b9bf0922712c32024c017c704d8465a80c0c69b098d71bbc9ade3d342935e14c942fc5c3439c5a605eceaf71e044bf389a969995bb986e0adbf45c0f51709714cf6c87cdfcc5e2dcc04e80a979c3a76b3c88bd93c0f7e2ca103f90a72bf1a68bfc4900a63ccfc91b2b78351c8f3f79def0f5db57a6aa17b409d0ba493b7d297e1a80c03db8499618096d63715b877fee3bde38bf8ccc4f640cd5d6d1d0411200154c2315f89fed139e035d551f2dd652d72c6980d775fdb890f13a9b460e276849abb8f2e502fecc3f7b79ebf8fc7a4a9e6922953301aac0f12799370ae4022232119dcb65ea4fc148258ba6b0c812fba53613013391705d1f438ff6bec0bb302489a6a6765c0e9e0ff71ac091b93cbee17aaa0a18fef3f0a1476b06f0ad74ad91cd527c9b9a3bd570b40607271bd5cf53b21164cbf27b6be3a4b251b5b41fa679ac6f7da2cb7835399aaab10b3250455f3d1d924ceb073e804834c6f737e02f0e88ba7c62dbc38441132c6fda9da1daa266621a40a03dc04f1d0b58f7bc97bdd4907cc784ec7e2ca3181ff691c848370687d4e9dff9ff1602aef7382076564bf99df48c342bc8a196815ade64c33a3aadef2f5136136dda55f8767325fb4d9ca51a80fbc5e47f79af8e3e7c60ca5f2e68c92cdb0a1e52fadecf2eacbff231156f77ba4cb1860c2ae671668f9240d68fcf0e0b8580ed9efe4af3b2c3994c2d5c71fc991990b6d0d96837af1037c9a8dc749794ebe7a421f7fec1fd92c7a8c53f13664fd420cc3a6076c0edc409993a4be155a06c51e7b012bc64542332e181494379e4159796da63fe34b421318d2be9d93c30d57d21421a7e5f57f7304f38fbf507a4c2ea75d36e256d0cb56ccec8d7d154bb3a2b84fb0103301818d3555aa1aa31a1ca60e5da544a3a216babe2598cfd9b30d4e2678ec1ad0185213300de68d50da6486be7967c8d518fec02a03f0f4594de1b1ff1a255777ba48dbd2fce2626daf87f1f6c5e981c62640eb794282d5297642683c25b8cb8a1db5683757378d6fd2494fa06f44e5c595ace4bcacd2653a12275511ca80668b707e9194452f40b411cedd81e45f1d969fb90a38f721a26250db2f140e6b1afb4203fa6c22248a89fb4bf8a998a73b0b63edf42a602bf5d8a3e2b570ff0446f53ecc47c3836d809b7e91ea6911fb1b6fd08d47aef7ba83952c2f1ac38d3f68b920973cec8b2c33a472087a18900ad1247c179c8ee8844461a2e4717be27b56df783e2b4f96a31046f3ed3c47067949ea09cfe1130cf313f67be5eef552c4858b3d0fcb14d44ba7fbcd239eea3f9e7fe940bdae462d06a53e21afa2f41891b5a4bc3ecd1304820a400994bf8ecca4eaf409557c976dfe3a1ad3afc664d83511e5d56b96a38d4e3bd7bdca6f4b38507dfaa121c17c1c93c737c9f7b9c3afecda69f07e2d70a640a16e9f7ced60e38b75e17a049f1976494cc136cb9bf8f4062fe69bd894f5642792cb44466b7aaf3a3af69b92851ed3e3862827d8c561a92b3d798b55806bf38840c66f6a8a227ef4f7670ae465cfa7e3d77418bc7cfdb371f701f2bdd6e55d69795050054a5b05dcde6d95b355bfe22d56ffb9db6f23989827ca4871cca1e171b800d125d94e8d69bdcdf42bac610d329bbe0abe32bc540983e2aa12eee00b2cb5ab3ce96b9c91aa1902378ac53f7cb4cd7ff35dcdc67d4e26a8b87567defa7a04fd65538118c3de1c0311bf5150055c8133d4b88e12ec08866a27a183a774d89d95021ed3ec38c67782e79999c5dd82061fd29dbd6aecb9e6c068234c7427cc84c96efaa2466de2009c6e2b0772500bd8f83c47c3185995f72a3042e0b3cda5a14efd5c96b0fe1022c1849c2579a0ec7b7123e7dd7c62012d9e5009c06b821ff89441c4615d0031474d63fc341d2116029a5a35bd839262333c73fc7c1d6064f8d0e72f1c835a7bf723d19acf77dfb6f303b854e5b4651c57095eb0cac1a81afd9e6d823ff83a65b14c3d0cbe60001665c97e962cfa02bc6a892d30c830fd4fedc1eec7393dcebe55bdcc62fdeb9423b70c133fadb6294bf61ac45f7fe042f87552d5ac6d0d2c3f54a7b17a703a003d422427ef753fbdb2d2240ac18a47f4e77c0544bd6ad34b16b605f4e6778a1ab17178d6db287075718eea038d7b4def7837be9f0f2a25335962aa5f8c1fcd5224c3440a80c05adb80e9f807f1c3e1bb3d4000972ce897f9d9636bc0409f5283df0e5e9a09dacb80d7fa40ee343dd99fd47506319f408e2e24748b11d04d440dd915351f2f248a28220c931438de307513eb735dd115d12f0671a7d217e24edd7e85c8bff7d8a64f74df5725cc73fbbeeadf6217544ddb5e341574ec45e77acf3d09f3d84973261f7777ba9df59763bb8c54bb4574e14506016320abfb1e31a5e50b19fdc6f6be1f53560cb78a2d136486491d791412937e9f2a106d67d25472a47bdfe71957819c233f42afdee152f65bb62eaf1b3e59a32ac57701f5fa6f884d78a7535a624a407add90fa5f487f2a03ac9428c2812cc14baa1a52563480ed9f09968e63858f8ee6950c87c0622bcc05a113da04b458fc3cfb915338d40e618df58775bf3f66ebd7b91fc1a28c033d5e10e9c832d5133764a8a0f9f75f9367884b5a05497c1fd3029cc9abebd5ccb6252753b972b5d3169df2e1b645dac7b8b7917affd1453654f20bb02255e1c2214784135d3adc5d4f8660f215db3a160e07d07fb9f78a7a28f26b7da8d4074ddf67ff79138c090af77613be0f6d0cf8c9ddec786c91f44e71964242f5ce6d6e40c9be7297fa8335596f60808f65595629116017a04b9bc18778e02560a7b8746e07cefc9c77bfa1752c73b0fb0fd7e8b2ed6e8234ce868507e44f088ebfe2d405f6e776d1b9e809c45f9ee659436444ea5aa5e4ba46cee71fa01c8075bb22ac4a0265d4f7b291a3a2f048fcf6f661615db0f919ac5b1a823e8eb7c5b41d05e69dcb574f1ad42ce637e56d2fce11fa64b738aa12816208adac6007058a8c18f64f2067398682d6e141d7b498db1b147518c24929a79ffe3adb9d08a4ac9434b4c71b6f246ae2380d8e817bdaf797abb393fe296aaa0ec4272e0446b8ed4c720fbf82cf20879acfa00d79b7cd7b5db8dde43838b5619db7070ca038de5a55014841e035e032ad85c6d768c751a60f319a1818a891f348fd85719ae2889e3e362892c03a8f03d9891fa233afc05535ddf6f1a56cc95e8d10bb090c1eda05b462696b5e0a60076b7b42b8b9bd859b0392b502d60d3130855bc2b5c3233a2c3e4c4a81b677a4efba9921d4b148d48dbbd9cfa8f8d8ff73c2fd38bd5a5122341b82c235b5620edf348db56d7b2f151ed618620b8c3fb70e7d2bda9e66e932399fc82acdb6128a541bc664c9d99917bc788ad7739e4d3af77d5e8a1bb4a8c0b0631d7f72fe2a2c108f36f81ba757ef3aca2a853f83033f0ee8e05a26226232f0d64deef4fbac1a3f90042078fa516d721473942b620efcf8a80891c0fdab037f495022684e8ad08623ba784c7cfd08d14dae511c623bf9c977c1c63f821e54acaddd58a179364452d45e6128c5eff567507cd60a3a05de60ded47a84b2282b87232eb2e8acaa6d39326f10f1ea77277a70d149d1802cd258bb6ebf6169d83d8c57e997501914d3f75ac840477a03f02e25a647d72b6f55f43636604df015b9480bc53bf338faaead57079e1f926b1b53bd42d580eb7cbf9bc9192b1d1eb84925e67af04f9694d9bcbe0ffc969dfbdfd5107ab5b10880c92da638c6334db95ef5479eb0ad8f2bd5ea42f3dc8510383bc515aa7d6869380e9160c8bacb78a23c7c733be086ecb51b3d5d984c211a05cd8acc9bb3cd3d7ad7f35eb1eb752e27b0a258a91a27673fb1499d9d42a3ec33f17ae7ff180d09092f2c79e7e336b8c8681147add97f6e9857f56f50963a9454988282d0c9f91251d9248cc7e6d69681013cf23428426e97e2138b53093e7aaaf32b3b0271acaca36bfddfe245e68bfb4216986d7d902291d74f11ba3483383dafedb06a35b5ad7102dd3b7a0e2368934f52b59fbdf29480ca99985187f8d7cf278ce87917c30700bd97d4533c89e650cc5795089e11cad144320b64a72c0973179f9d0e91a574f371d1d36b65c99f71a777826aa6fecb270fa8585c94e75feeef5f7a3efce550b164730768167f5ae0c755fefb92e5d11a2540dddf98f9917c412baa90d56d2150221583a2574f3eae8e01e122355f0f5ff3f777e11f0c6e0a349001a879b50ac0e00500e4869a43b23d6705ae25406cadd583a37195848c067262e0bd2a99c1127ac0d692714feda69c647678e39adc9b505f40fdb7f1a01ddb1badc8fd966229f5b4a477e041b103d4bf7e596bbfa8c53b9db4cea7091187a4132b82b98806e6eb9bb3c202559aec88ea66e20ce6ffe1b40ee1d677667911011598938928498a67639a84bbe125940be82e2484824f7c389f6a8d4aefc8e3fda23e2e46183434e3079aeb1b04f0a2623b00ba524a47f54d50e8adce6d0cc8f8091fc2da0095642f0e70044c63ecc8bcc710af003efeaa37707af14db8d628d74019e4772d858f46867085463e1e1814d6b5939ab0694b53d0167a9863e3f3f325dd492e76d7d4cd0c7fc25456253be00326bcceeeef0246a51cdcf40b48686bc9e976e29574603bd030d62cb5899315402c1badf7d994d53c441fa66c733d6333f0b27b9bc3db86744050ca464e07db02e04c910fed9fa8d6e941922c4518b25ae251d1885ada93643da27b6071c74fd57e7772bb60121d816f08cf64b85e25337722cdc1d5b02c4e72a7b86934c2e49552463b137bce5dd50f1dc5aa7baf85dfeae50ec1ff3d03bfa255c9b40193d30edfe6cddb372ae754113b9969aa1bfd8f7accc02d11bffd00b2b37080adf7ca4ab979a271cbfc08b0fc71de0a8ec72089d8895c32bed74de1e8aa827f91834fdf8c6af66351c8aa65132c8cc5ba6d7a57583382d7127300fcb385126d39ba9ba92983813ef699a27311aafd61c5a4f7da9a81b50a4c233f35df4aacf0d2d0a3599bb04f10775a061ae69991f741a7ffe297e04c1a7167a768cd959a376b5162914d7c18109282c00a110cf85454f247d3b19ffa1149588cc7e8113690eb4acc74322716b68c7c295cbc972fb57c0197f11873d658a4f6bc7b3b5c8e48faddd19dd50856de3af39e31e9b9eaa91222c5741e068182cb67f6e28e0a6c9d15e6cd46b59536dff2f40b3d7e167749ee85e279ed103e6d4367dedddad617de097e6fefbe4ec83c420a7a4107b0f45d4f988619271abd29f4617768dca69ed2e08259a920be10d3ebb46596bc7ee85b736c9ceb5e025f92247dcc2cc9918790ebe609024de63db3b4702d0f9734aca76f13c8ba6cfd46e72199c44faedf74c08da517f7ad9e4e9a65bb29e229a56e477287e360c705387f26893313a7d54b9f1678d5246cf2df7c7eb156d7d17e5e3b7f037ab115d0c0d4857543394fa220f745ffe7bb80c06eb9c2e8235949820595ba3675cb70c09a22f9cb07426bd6d178eeb658d8d2e5126b2eb7d6690385eb27d0b5a05c9bd687a30424fd7322e7d41cf05020b2c37cda082c61dab056d1feead730e406f73cec524ff7889585878eda17f89635b24df77c5403a636cf3ac8034ae0ccfa53de02602bb211d5f2e0068ab34c4cb6664f4898062fda2c8bc1bdb3447daa4a596a465e12b5fb832a4027cd1d90f22beda912c27772eadb1e122b50f81d827d5c376f0e15580d75560f4d9df8449bc863e7153d60f62b7080ccd03379f3f5206f6e94687ecc118ad2dd4d73651e6f8b852141a1ac68b2640204bf847f674165508b1eff194217f83c6252b875a826e2abeed45aadf77724d00670d8a6fd87ddf0f97a76a2484f97d0f7a29c9610263636e44af69dedc0d4aaa7b48cfc1bdf72906f4e0ed22db6af9a89e21a2eef59ef9f22ff9a855fccf17a5071ed916648637654a69fc7e210a29063716a852808fe82e1394da32f60aa2de2429621d1fbde4c9a6084949564ec0b48971347d1701e7b9685a754d27b97bd6b14d3d7a036a5a42278bdf3b4523c00c6e1326683bc4db63b639be04558901d0a82b60f1cbdf4d38771575a5b0da8ff99eed4bc3e11814ecffe9dcb461b0a8397f16100207b9f59c964a75ad48fdab7822372140cc2575a583f96702e078287e298ccba7021fba537e0a18be614992a036a73b17fd17826e0295852dc12d560451a2bbee17723da4e8b2c19c7fed64b8b518a9cdd5f37ec4ef4e6d08e37ffac45d2caf34350981c0041ec7b98ba03e3055bd8d312d4ce673e565895d45b60e9637e9004ecfc3515bb3e5d6b6dd2a0f15d2b824c2773fe502312b4f90fd3465dfdfb42a5320394e205eec1fd525aa8fe883e9e8a685d1ff17f79f523b2fecb2f5b37aecb0ac8242927c69546e94cfb43e945843c4bfb2a524f6065acd90f95a02a60a71122fc6811d0c24879678cf9bc46574a42d4c28a358bdb50fa75837d210d79321660d23ac74ccafac9924d7f9ec6b0c47000923ef166591eb298771f49f259b68d4761c05b89a0b26e86e95e0780154bb3d063af4aa77d20886e6819cc894bf428fad279b58f9c8d894c295ac42f1c85d4ec50a6cad1e66c6d5dccc1085a8774cdae461c83893e9d0cc6445fe978f5ec3775bb3cf65a3081d7597f90096801f25f4726389e3acc10dea3ff21ecf3f6a7035442051c3f107d4941e8d5dcd551ef9bb04818eab3cd051eeea6365a029840b38e3801c435b1fd68639a25cb5f63c50fef994103afb8e3d51ead7314b5fa5ef7e678b6ed7f70a78b6b39713160fc1197731b93b5ff765653ec0d5a4034c878861e8ab97fa47e83e4e459f0e4d6d58ef1a165c683d745674bdf0fc98ab80ea839b6a2dfb7f8b62284da15f858073f2a555cfd145170f3ae71b6037dc1a51f0b4e5949cecbcf26a50872e1e06e300462dbaf17ff4d096376244db705479fbb8a34b5c7771ca7e836411449261b8cd5dd2d2e8f365c3e082e9c2c76858c7fcc01e4cbbf27a67e38742dc568256154aba98ba1d54039a019d999f622a85daff462b03a565322cafbc24db7add8cad822c4d760cc719a76d3e8c2b6091177bb6934f22edac5aed3ab94ea61e787b3fcdcc7c078034376920a01dbae5bc6189355692d36a40f12584f406d07731470463a3cdcfee664d600d582607e806a0bf8929c5e5b8a8304eee3c68160714085ac9464442bd4735734b0b4fa8918225cbfd671a02c3d0a4a083933d07eaa66fb96116b43a79c406389b96c58a043d96d923d5be906c97ededb1117b33a1820d1d8d710b24dc9c70722cc22ea89c08503a5a3e9e847344408b983f7744c616f491f9901c2e80df0a6629031f524138f07fea5bb9c9d8d35af5fe1f8df581024372bec6adce05120fef9ddf203d866b9cf1e51398a9069d2c8a7ec0850df88fb4b01199bd8739b478a252786f3588fa7360f24b92ee04e2c71f1cee2aba1539177ae6594f29ab958147b4f7d0865e7014eb22024aad35decec92d0ecc16a7b2de6a6f7d257c0f76a6ff58ed222d2dec4e6395c6ec12ffe6d8a149165993b28b90414ae8071a47bdb1fb93d4f995fdf56489c92253c365db72576f32941677ae904ff20f91cb9137600db63f0f788c4d4a278e6264702a4678ef627356115aea18759ef8e2534740413cc08e551520ec76476c67d01e6c1f2f793cea574277ee5f237ea0de55ca86403ea47ba44e1261191ae4225a43a043b54ff3932b96298b972620ec2d1d6a148802fcd5a7fa2249c20bf8b9fe2a67764a5094560c030e5656775f58860bc3b4feeb8bcd7718a68144e9788cb00d85362bb424e2dc79bcff8c5943c2557a19fa971d153a9f251304c888f89880344fca5d89e2a0df673ff773d7c2c4d294fbf2ad173b498291fb71e33ab634a03b59e7c66fb3e689de1f410c0a3ba85b93020863d20afea2511185433c18790aa72f210e1994a41c4c769c58ad378f645b00abad78178f66b4e10f6fd733ac078438c6646543b376f7386faac12df248d35b6e95b09d4a80382e690c162955c6dfdf3ba5e5f23215e1fe2c7feca98378d2b1409a2a0f2d52ddd87542b01568df76a2569e13690400a6fb1f510f7c9748dd37a80ca6d4b68d12febe913d1e96769af1b3812cd5109b194dfe7a488fb7b084cda35bcf630404aad26090e833790b9ca2096c87655079d99b4f84b293eec5c5822f4fa180bab688f6259a90302ed8396aea513d5093e8ff7b2fec1e13cba6ab8eb03c075bf5c0a0f57b10a1fb0f8a6a77b42137e97c62541a8249973eec757f7189db29642d4999f83bae6b41853b519ea9b8a0ef6f236bc67c74ee4a14e8d53e9e5082320d70a2c727d32426f1fd3b9dd8d65143090a886132e0e2b66660f3a9d9296662585aff39df2c8b042da293018bbc757ca9cef3fc59932664a9f71e282a3b35545fb3e065919b4390fe8bee619ac0ebd44cfebf19574a5b81f229f5006da9f393cf7b5f06fc162ffc5eb30ac33a176870ad20522f76aadcd5fea21e599139e5d20bcc8dc3dd77e6efa81c8f9e47ef7a08ceee6f73fb9bb0bcdcd4e995b560263db35ac5f090e42dee47ca6f66433c9d999ecc5786f6641a3345f18707470199251afc34557a44294f","isRememberEnabled":true,"rememberDurationInDays":30,"staticryptSaltUniqueVariableName":"666125d2285f1dab0f009ee7052c866f"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
